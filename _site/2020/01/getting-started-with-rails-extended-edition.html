<!DOCTYPE HTML>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <title>Getting Started with Rails: Extended Edition - Ryan Bigg</title>
  <link rel="shortcut icon" href="https://ryanbigg.com/favicon.png" type="image/x-icon">
  <link href="http://feeds.feedburner.com/ryanbigg" rel="alternate" title="The Life of a Radar" type="application/atom+xml" />
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,700|Ubuntu+Mono:400,700,700i&display=swap" rel="stylesheet">
  <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
  <link rel='stylesheet' href='/css/style.css' media='screen'>
  <link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/dracula.min.css">
<script src="/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

  <body>
    <header class="topbar">
  <h1><a href="/">Ryan Bigg</a></h1>

  <div class='items'>
    <a href="/">Who?</a> &middot;
    <a href="/books">Books</a> &middot;
    <a href="/blog">Blog</a> &middot;
    <a href="/setup">Setup</a> &middot;
    <a href="/history">History</a> &middot;
    <a href="/now">Now</a> &middot;
    <a href="/mentoring">Mentoring</a>
  </div>
</header>

    <div class="main">
      <div class='content'>
        <div class='content-inner'>
          <article>
            <div class='center'>
              <a href="/2020/01/getting-started-with-rails-extended-edition"><h2>Getting Started with Rails: Extended Edition</h2></a>
              <small>19 Jan 2020</small>
            </div>
            <p>This guide is an <em>extended edition</em> of the offical <a href="https://guides.rubyonrails.org/getting_started.html">Getting Started with Rails</a> guide.</p>

<p>This extended version has the following additions:</p>

<ul>
  <li>A re-worked introduction to routing, showing clearer matching between routes and controllers.</li>
  <li>Creates and uses a model right after building the first route.</li>
  <li>Examples of HTML output generated by Rails helpers such as <code class="language-plaintext highlighter-rouge">link_to</code>, <code class="language-plaintext highlighter-rouge">form_with</code> and <code class="language-plaintext highlighter-rouge">text_field</code>.</li>
  <li>Beef up explainations of routing helpers, especially <code class="language-plaintext highlighter-rouge">article_comment_path</code>.</li>
  <li>Beef up explainations in general.</li>
</ul>

<hr />

<p>This guide covers getting up and running with Ruby on Rails.</p>

<p>After reading this guide, you will know:</p>

<ul>
  <li>How to install Rails, create a new Rails application, and connect your
application to a database.</li>
  <li>The general layout of a Rails application.</li>
  <li>The basic principles of MVC (Model, View, Controller) and RESTful design.</li>
  <li>How to quickly generate the starting pieces of a Rails application.</li>
</ul>

<hr />

<h2 id="guide-assumptions">Guide Assumptions</h2>

<p>This guide is designed for beginners who want to get started with a Rails
application from scratch. It does not assume that you have any prior experience
with Rails.</p>

<p>Rails is a web application framework running on the Ruby programming language.
If you have no prior experience with Ruby, you will find a very steep learning
curve diving straight into Rails. There are several curated lists of online resources
for learning Ruby:</p>

<ul>
  <li><a href="https://www.ruby-lang.org/en/documentation/">Official Ruby Programming Language website</a></li>
  <li><a href="https://github.com/EbookFoundation/free-programming-books/blob/master/free-programming-books.md#ruby">List of Free Programming Books</a></li>
</ul>

<p>Be aware that some resources, while still excellent, cover versions of Ruby as old as
1.6, and commonly 1.8, and will not include some syntax that you will see in day-to-day
development with Rails.</p>

<h2 id="what-is-rails">What is Rails?</h2>

<p>Rails is a web application development framework written in the Ruby programming language.
It is designed to make programming web applications easier by making assumptions
about what every developer needs to get started. It allows you to write less
code while accomplishing more than many other languages and frameworks.
Experienced Rails developers also report that it makes web application
development more fun.</p>

<p>Rails is opinionated software. It makes the assumption that there is a “best”
way to do things, and it’s designed to encourage that way - and in some cases to
discourage alternatives. If you learn “The Rails Way” you’ll probably discover a
tremendous increase in productivity. If you persist in bringing old habits from
other languages to your Rails development, and trying to use patterns you
learned elsewhere, you may have a less happy experience.</p>

<p>The Rails philosophy includes two major guiding principles:</p>

<ul>
  <li><strong>Don’t Repeat Yourself:</strong> DRY is a principle of software development which
states that “Every piece of knowledge must have a single, unambiguous, authoritative
representation within a system”. By not writing the same information over and over
again, our code is more maintainable, more extensible, and less buggy.</li>
  <li><strong>Convention Over Configuration:</strong> Rails has opinions about the best way to do many
things in a web application, and defaults to this set of conventions, rather than
require that you specify minutiae through endless configuration files.</li>
</ul>

<h2 id="creating-a-new-rails-project">Creating a New Rails Project</h2>
<p>The best way to read this guide is to follow it step by step. All steps are
essential to run this example application and no additional code or steps are
needed.</p>

<p>By following along with this guide, you’ll create a Rails project called
<code class="language-plaintext highlighter-rouge">blog</code>, a (very) simple weblog. Before you can start building the application,
you need to make sure that you have Rails itself installed.</p>

<p>TIP: The examples below use <code class="language-plaintext highlighter-rouge">$</code> to represent your terminal prompt in a UNIX-like OS,
though it may have been customized to appear differently. If you are using Windows,
your prompt will look something like <code class="language-plaintext highlighter-rouge">c:\source_code&gt;</code></p>

<h3 id="installing-rails">Installing Rails</h3>

<p>Before you install Rails, you should check to make sure that your system has the
proper prerequisites installed. These include Ruby and SQLite3.</p>

<p>Open up a command line prompt. On macOS open Terminal.app, on Windows choose
“Run” from your Start menu and type ‘cmd.exe’. Any commands prefaced with a
dollar sign <code class="language-plaintext highlighter-rouge">$</code> should be run in the command line. Verify that you have a
current version of Ruby installed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ruby <span class="nt">-v</span>
ruby 2.7.0
</code></pre></div></div>

<p>Rails requires Ruby version 2.5.0 or later. If the version number returned is
less than that number (such as 2.3.7, or 1.8.7), you’ll need to install a fresh copy of Ruby.</p>

<p>TIP: To quickly install Ruby and Ruby on Rails on your system in Windows, you can use
<a href="http://railsinstaller.org">Rails Installer</a>. For more installation methods for most
Operating Systems take a look at <a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>.</p>

<p>If you are working on Windows, you should also install the
<a href="https://rubyinstaller.org/downloads/">Ruby Installer Development Kit</a>.</p>

<p>You will also need an installation of the SQLite3 database.
Many popular UNIX-like OSes ship with an acceptable version of SQLite3.
On Windows, if you installed Rails through Rails Installer, you
already have SQLite installed. Others can find installation instructions
at the <a href="https://www.sqlite.org">SQLite3 website</a>.
Verify that it is correctly installed and in your PATH:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sqlite3 <span class="nt">--version</span>
</code></pre></div></div>

<p>The program should report its version.</p>

<p>To install Rails, use the <code class="language-plaintext highlighter-rouge">gem install</code> command provided by RubyGems:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gem <span class="nb">install </span>rails
</code></pre></div></div>

<p>To verify that you have everything installed correctly, you should be able to
run the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails <span class="nt">--version</span>
</code></pre></div></div>

<p>If it says something like “Rails 6.0.0”, you are ready to continue.</p>

<h3 id="creating-the-blog-application">Creating the Blog Application</h3>

<p>Rails comes with a number of scripts called generators that are designed to make
your development life easier by creating everything that’s necessary to start
working on a particular task. One of these is the new application generator,
which will provide you with the foundation of a fresh Rails application so that
you don’t have to write it yourself.</p>

<p>To use this generator, open a terminal, navigate to a directory where you have
rights to create files, and type:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rails new blog
</code></pre></div></div>

<p>This will create a Rails application called Blog in a <code class="language-plaintext highlighter-rouge">blog</code> directory and
install the gem dependencies that are already mentioned in <code class="language-plaintext highlighter-rouge">Gemfile</code> using
<code class="language-plaintext highlighter-rouge">bundle install</code>.</p>

<p>NOTE: If you’re using Windows Subsystem for Linux then there are currently some
limitations on file system notifications that mean you should disable the <code class="language-plaintext highlighter-rouge">spring</code>
and <code class="language-plaintext highlighter-rouge">listen</code> gems which you can do by running <code class="language-plaintext highlighter-rouge">rails new blog --skip-spring --skip-listen</code>.</p>

<p>TIP: You can see all of the command line options that the Rails application
builder accepts by running <code class="language-plaintext highlighter-rouge">rails new -h</code>.</p>

<p>After you create the blog application, switch to its folder:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>blog
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">blog</code> directory has a number of auto-generated files and folders that make
up the structure of a Rails application. Most of the work in this tutorial will
happen in the <code class="language-plaintext highlighter-rouge">app</code> folder, but here’s a basic rundown on the function of each
of the files and folders that Rails created by default:</p>

<table>
  <thead>
    <tr>
      <th>File/Folder</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>app/</td>
      <td>Contains the controllers, models, views, helpers, mailers, channels, jobs, and assets for your application. You’ll focus on this folder for the remainder of this guide.</td>
    </tr>
    <tr>
      <td>bin/</td>
      <td>Contains the rails script that starts your app and can contain other scripts you use to setup, update, deploy, or run your application.</td>
    </tr>
    <tr>
      <td>config/</td>
      <td>Configure your application’s routes, database, and more. This is covered in more detail in <a href="configuring.html">Configuring Rails Applications</a>.</td>
    </tr>
    <tr>
      <td>config.ru</td>
      <td>Rack configuration for Rack based servers used to start the application. For more information about Rack, see the <a href="https://rack.github.io/">Rack website</a>.</td>
    </tr>
    <tr>
      <td>db/</td>
      <td>Contains your current database schema, as well as the database migrations.</td>
    </tr>
    <tr>
      <td>Gemfile<br />Gemfile.lock</td>
      <td>These files allow you to specify what gem dependencies are needed for your Rails application. These files are used by the Bundler gem. For more information about Bundler, see the <a href="https://bundler.io">Bundler website</a>.</td>
    </tr>
    <tr>
      <td>lib/</td>
      <td>Extended modules for your application.</td>
    </tr>
    <tr>
      <td>log/</td>
      <td>Application log files.</td>
    </tr>
    <tr>
      <td>package.json</td>
      <td>This file allows you to specify what npm dependencies are needed for your Rails application. This file is used by Yarn. For more information about Yarn, see the <a href="https://yarnpkg.com/lang/en/">Yarn website</a>.</td>
    </tr>
    <tr>
      <td>public/</td>
      <td>The only folder seen by the world as-is. Contains static files and compiled assets.</td>
    </tr>
    <tr>
      <td>Rakefile</td>
      <td>This file locates and loads tasks that can be run from the command line. The task definitions are defined throughout the components of Rails. Rather than changing <code class="language-plaintext highlighter-rouge">Rakefile</code>, you should add your own tasks by adding files to the <code class="language-plaintext highlighter-rouge">lib/tasks</code> directory of your application.</td>
    </tr>
    <tr>
      <td>README.md</td>
      <td>This is a brief instruction manual for your application. You should edit this file to tell others what your application does, how to set it up, and so on.</td>
    </tr>
    <tr>
      <td>storage/</td>
      <td>Active Storage files for Disk Service. This is covered in <a href="active_storage_overview.html">Active Storage Overview</a>.</td>
    </tr>
    <tr>
      <td>test/</td>
      <td>Unit tests, fixtures, and other test apparatus. These are covered in <a href="testing.html">Testing Rails Applications</a>.</td>
    </tr>
    <tr>
      <td>tmp/</td>
      <td>Temporary files (like cache and pid files).</td>
    </tr>
    <tr>
      <td>vendor/</td>
      <td>A place for all third-party code. In a typical Rails application this includes vendored gems.</td>
    </tr>
    <tr>
      <td>.gitignore</td>
      <td>This file tells git which files (or patterns) it should ignore. See <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> for more info about ignoring files.</td>
    </tr>
    <tr>
      <td>.ruby-version</td>
      <td>This file contains the default Ruby version.</td>
    </tr>
  </tbody>
</table>

<h2 id="hello-rails">Hello, Rails!</h2>

<p>To begin with, let’s get some text up on screen quickly. To do this, you need to
get your Rails application server running.</p>

<h3 id="starting-up-the-web-server">Starting up the Web Server</h3>

<p>You actually have a functional Rails application already. To see it, you need to
start a web server on your development machine. You can do this by running the
following in the <code class="language-plaintext highlighter-rouge">blog</code> directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails server
</code></pre></div></div>

<p>TIP: If you are using Windows, you have to pass the scripts under the <code class="language-plaintext highlighter-rouge">bin</code>
folder directly to the Ruby interpreter e.g. <code class="language-plaintext highlighter-rouge">ruby bin\rails server</code>.</p>

<p>TIP: JavaScript asset compression requires you
have a JavaScript runtime available on your system, in the absence
of a runtime you will see an <code class="language-plaintext highlighter-rouge">execjs</code> error during asset compression.
Usually macOS and Windows come with a JavaScript runtime installed.
<code class="language-plaintext highlighter-rouge">therubyrhino</code> is the recommended runtime for JRuby users and is added by
default to the <code class="language-plaintext highlighter-rouge">Gemfile</code> in apps generated under JRuby. You can investigate
all the supported runtimes at <a href="https://github.com/rails/execjs#readme">ExecJS</a>.</p>

<p>This will fire up Puma, a web server distributed with Rails by default. To see
your application in action, open a browser window and navigate to
<a href="http://localhost:3000">http://localhost:3000</a>. You should see the Rails default information page:</p>

<p><img src="/images/getting_started/rails_welcome.png" alt="Yay! You're on Rails! screenshot" /></p>

<p>TIP: To stop the web server, hit Ctrl+C in the terminal window where it’s
running. To verify the server has stopped you should see your command prompt
cursor again. For most UNIX-like systems including macOS this will be a
dollar sign <code class="language-plaintext highlighter-rouge">$</code>. In development mode, Rails does not generally require you to
restart the server; changes you make in files will be automatically picked up by
the server.</p>

<p>The “Yay! You’re on Rails!” page is the <em>smoke test</em> for a new Rails
application: it makes sure that you have your software configured correctly
enough to serve a page.</p>

<h3 id="say-hello-rails">Say “Hello”, Rails</h3>

<p>To get Rails saying “Hello”, you need to create at minimum a <em>route</em>, a <em>controller</em> and a <em>view</em>.</p>

<p>A controller’s purpose is to receive specific requests for the application.
<em>Routing</em> decides which controller receives which requests. Often, there is more
than one route to each controller, and different routes can be served by
different <em>actions</em>. Each action’s purpose is to collect information to provide
it to a view.</p>

<p>A view’s purpose is to display this information in a human readable format. An
important distinction to make is that the <em>controller</em>, not the view,
is where information is collected. The view should just display that information.
By default, view templates are written in a language called eRuby (Embedded
Ruby) which is processed by the request cycle in Rails before being sent to the
user.</p>

<p>When we make a request to our Rails applications, we do so by making a request to a particular <em>route</em>. So to start off, we’ll start with a route. Let’s create one now in <code class="language-plaintext highlighter-rouge">config/routes.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>

  <span class="c1"># For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is your application’s <em>routing file</em> which holds entries in a special
<a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL (domain-specific language)</a> that tells Rails how to connect incoming requests to
controllers and actions.</p>

<p>The line that we have just added says that we are going to match a <code class="language-plaintext highlighter-rouge">GET /welcome</code> request to <code class="language-plaintext highlighter-rouge">welcome#index</code>. This string passed as the <code class="language-plaintext highlighter-rouge">to</code> option represents the <em>controller</em> and <em>action</em> that will be responsible for handling this request.</p>

<p>Controllers are classes that group together common methods for handling a particular <em>resource</em>. The methods inside controllers are given the name “actions”, as they <em>act upon</em> requests as they come in.</p>

<p>To create a new controller, you will need to run the “controller” generator and
tell it you want a controller called “articles” with an action called “index”,
just like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails generate controller articles index
</code></pre></div></div>

<p>Rails will create several files and a route for you.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create  app/controllers/articles_controller.rb
  route  get <span class="s1">'articles/index'</span>
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    <span class="nb">test</span>/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/articles.scss
</code></pre></div></div>

<p>Most important of these are is of course the controller, located at
<code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code>.</p>

<p>Let’s look at that controller now:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This controller defines a single action, or “method” in common Ruby terms, called <code class="language-plaintext highlighter-rouge">index</code>. This action is where we would define any logic that we would want to happen when a request comes in to this action. Right at this moment, we don’t want this action to do anything, and so we’ll keep it blank for now.</p>

<p>When an action is left blank like this, Rails will default to rendering a view that matches the name of the controller, and the name of the action. That view is going to be <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>.</p>

<p>Open the <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code> file in your text editor. Delete all
of the existing code in the file, and replace it with the following single line
of code:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Hello, Rails!<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<p>If we go back to our browser and make a request to <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>, we’ll see our text appear on the page.</p>

<h3 id="setting-the-application-home-page">Setting the Application Home Page</h3>

<p>Now that we have made the route, controller, action and view, let’s make a small change to our routes. In this application, we’re going to change it so that our message appears at <a href="http://localhost:3000/">http://localhost:3000/</a> and not just <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>. At the moment, at <a href="http://localhost:3000">http://localhost:3000</a> it still says “Yay! You’re on Rails!”.</p>

<p>To change this, we need to tell our routes file where the <em>root path</em> of our application is.</p>

<p>Open the file <code class="language-plaintext highlighter-rouge">config/routes.rb</code> in your editor.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="c1"># For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Underneath the line that is there, add this line:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>A slightly shorter way of writing the same thing is:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">root</code> method defines a <em>root path</em> for our application. The <code class="language-plaintext highlighter-rouge">root</code> method tells Rails to map requests to the root of the application to the <code class="language-plaintext highlighter-rouge">ArticlesController</code> <code class="language-plaintext highlighter-rouge">index</code> action.</p>

<p>Launch the web server again if you stopped it to generate the controller (<code class="language-plaintext highlighter-rouge">rails
server</code>) and navigate to <a href="http://localhost:3000">http://localhost:3000</a> in your browser. You’ll see the
“Hello, Rails!” message you put into <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>,
indicating that this new route is indeed going to <code class="language-plaintext highlighter-rouge">ArticleController</code>’s <code class="language-plaintext highlighter-rouge">index</code>
action and is rendering the view correctly.</p>

<p>TIP: For more information about routing, refer to <a href="routing.html">Rails Routing from the Outside In</a>.</p>

<h2 id="creating-a-model">Creating a model</h2>

<p>So far, we have seen routes, controllers, actions and views within our Rails application. All of these are conventional parts of Rails applications and it is done this way to follow the MVC pattern. The MVC pattern is an application design pattern which makes it easy to separate the different responsibilities of applications into easy to reason about pieces.</p>

<p>So with “MVC”, you might guess that the “V” stands for “View” and the “C” stands for controller, but you might have trouble guessing what the “M” stands for. This next section is all about that “M” part, the <em>model</em>.</p>

<p>A model is a class that is used to represent data in our application. In a plain-Ruby application, you might have a class defined like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span>
  <span class="nb">attr_reader</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">:,</span> <span class="n">body</span><span class="p">:)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="vi">@body</span> <span class="o">=</span> <span class="n">body</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Models in a Rails application are designed for this purpose too: to represent particular data.</p>

<p>Models have another purpose in a Rails application too though. They’re also used to interact with the application’s database. In this section, we’re going to use a model to put data into our database and to pull that data back out.</p>

<p>To start with, we’re going to need to generate a model. We can do that with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails g model article title:string body:text
</code></pre></div></div>

<p>NOTE: The model name here is <em>singular</em>, because model classes are classes that are used to represent single instances. To help remember this rule, in a Ruby application to start building a new object, you would define the class as <code class="language-plaintext highlighter-rouge">Article</code>, and then do <code class="language-plaintext highlighter-rouge">Article.new</code>, not <code class="language-plaintext highlighter-rouge">Articles</code> and <code class="language-plaintext highlighter-rouge">Articles.new</code>.</p>

<p>When this command runs, it will generate the following files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>invoke  active_record
create    db/migrate/[timestamp]_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      <span class="nb">test</span>/models/article_test.rb
create      <span class="nb">test</span>/fixtures/articles.yml
</code></pre></div></div>

<p>The two files we’ll focus on here are the <em>migration</em> (the file at <code class="language-plaintext highlighter-rouge">db/migrate</code>) and the <em>model</em>.</p>

<p>A migration is used to alter the structure of our database, and it is written in Ruby. Let’s look at this file now, <code class="language-plaintext highlighter-rouge">db/migrate/[timestamp]_create_articles.rb</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This file contains Ruby code to create a table within our application’s database. Migrations are written in Ruby so that they can be database-agnostic – regardless of what database you use with Rails, you’ll always write migrations in Ruby.</p>

<p>Inside this migration file, there’s a <code class="language-plaintext highlighter-rouge">create_table</code> method that defines how the <code class="language-plaintext highlighter-rouge">articles</code> table should be constructed. This method will create a table in our database that contains an <code class="language-plaintext highlighter-rouge">id</code> auto-incrementing primary key. That means that the first record in our table will have an <code class="language-plaintext highlighter-rouge">id</code> of 1, and the next <code class="language-plaintext highlighter-rouge">id</code> of 2, and so on.  Rails assumes by default this is the behaviour we want, and so it does this for us.</p>

<p>Inside the block for <code class="language-plaintext highlighter-rouge">create_table</code>, we have two fields, <code class="language-plaintext highlighter-rouge">title</code> and <code class="language-plaintext highlighter-rouge">body</code>. These were added to the migration automatically because we put them at the end of the <code class="language-plaintext highlighter-rouge">rails g model</code> call:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails g model article title:string body:text
</code></pre></div></div>

<p>On the last line of the block is <code class="language-plaintext highlighter-rouge">t.timestamps</code>. This method defines two additional fields in our table, called <code class="language-plaintext highlighter-rouge">created_at</code> and <code class="language-plaintext highlighter-rouge">updated_at</code>. When we create or update model objects, these fields will be set respectively.</p>

<p>The structure of our table will look like this:</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>title</th>
      <th>body</th>
      <th>created_at</th>
      <th>updated_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>To create this table in our application’s database, we can run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails db:migrate
</code></pre></div></div>

<p>This command will show us output indicating that the table was created:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>== 20200118233119 CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
== 20200118233119 CreateArticles: migrated (0.0018s) ==========================
</code></pre></div></div>

<p>Now that we have a table in our application’s database, we can use the model to interact with this table.</p>

<p>To use the model, we’ll use a feature of Rails called the <em>console</em>. The console allows us write code like we might in <code class="language-plaintext highlighter-rouge">irb</code>, but the code of our application is available there too. Let’s launch the console with this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails console
</code></pre></div></div>

<p>Or, a shorter version:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails c
</code></pre></div></div>

<p>When we launch this, we should see an irb prompt:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading development environment (Rails 6.0.2.1)
irb(main):001:0&gt;
</code></pre></div></div>

<p>In this prompt, we can use our model to initialize a new <code class="language-plaintext highlighter-rouge">Article</code> object:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">)</span>
</code></pre></div></div>

<p>When we use <code class="language-plaintext highlighter-rouge">Article.new</code>, it will initialze a new <code class="language-plaintext highlighter-rouge">Article</code> object in the console. This object is not saved to the database at all, it’s just available in the console so far. To save the object to the database, we need to call <code class="language-plaintext highlighter-rouge">save</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">article</span><span class="p">.</span><span class="nf">save</span>
</code></pre></div></div>

<p>This command will show us the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(0.1ms)  begin transaction
Article Create (0.4ms)  INSERT INTO "articles" ("title", "body", "created_at", "updated_at") VALUES (?, ?, ?, ?)  [["title", "Hello Rails"], ["body", "I am on Rails!"], ["created_at", "2020-01-18 23:47:30.734416"], ["updated_at", "2020-01-18 23:47:30.734416"]]
(0.9ms)  commit transaction
=&gt; true
</code></pre></div></div>

<p>This output shows an <code class="language-plaintext highlighter-rouge">INSERT INTO "articles"...</code> database query. This means that our article has been successfully inserted into our table.</p>

<p>If we take a look at our <code class="language-plaintext highlighter-rouge">article</code> object again, an interesting thing has happened:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">article</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Article id: 1, title: "Hello Rails", body: "I am on Rails!", created_at: "2020-01-18 23:47:30", updated_at: "2020-01-18 23:47:30"&gt;</span>
</code></pre></div></div>

<p>Our object now has the <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">created_at</code> and <code class="language-plaintext highlighter-rouge">updated_at</code> fields set. All of this happened automatically for us when we saved this article.</p>

<p>If we wanted to retrieve this article back from the database later on, we can do that with <code class="language-plaintext highlighter-rouge">find</code>, and pass that <code class="language-plaintext highlighter-rouge">id</code> as an argument:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Article id: 1, title: "Hello Rails", body: "I am on Rails!", created_at: "2020-01-18 23:47:30", updated_at: "2020-01-18 23:47:30"&gt;</span>
</code></pre></div></div>

<p>A shorter way to add articles into our database is to use <code class="language-plaintext highlighter-rouge">Article.create</code>, like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">005</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Post #2"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"Still riding the Rails!"</span><span class="p">)</span>
</code></pre></div></div>

<p>This way, we don’t need to call <code class="language-plaintext highlighter-rouge">new</code> and then <code class="language-plaintext highlighter-rouge">save</code>.</p>

<p>Lastly, models provide a method to find all of their data:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">006</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
 <span class="c1">#&lt;ActiveRecord::Relation [</span>
   <span class="c1">#&lt;Article id: 1, title: "Hello Rails", body: "I am on Rails!", created_at: "2020-01-18 23:47:30", updated_at: "2020-01-18 23:47:30"&gt;,</span>
   <span class="c1">#&lt;Article id: 2, title: "Post #2", body: "Still riding the Rails!", created_at: "2020-01-18 23:53:45", updated_at: "2020-01-18 23:53:45"&gt;]&gt;</span>
</code></pre></div></div>

<p>This method returns an <code class="language-plaintext highlighter-rouge">ActiveRecord::Relation</code> object, which you can think of as a super-powered array. This array contains both of the topics that we have created so far.</p>

<p>As you can see, models are very helpful classes for interacting with databases within Rails applications. Models are the final piece of the “MVC” puzzle. Let’s look at how we can go about connecting all these pieces together into a cohesive whole.</p>

<h2 id="getting-up-and-running">Getting Up and Running</h2>

<p>Now that you’ve seen how to create a route, a controller, an action, a view and a model, let’s connect these pieces together.</p>

<p>Let’s go back to <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code> now. We’re going to change the <code class="language-plaintext highlighter-rouge">index</code> action here to use our model.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Controller actions are where we assemble all the data that will later be displayed in the <em>view</em>. In this <code class="language-plaintext highlighter-rouge">index</code> action, we’re calling <code class="language-plaintext highlighter-rouge">Article.all</code> which will make a query to our database and retrieve all of the articles, storing them in an instance variable: <code class="language-plaintext highlighter-rouge">@articles</code>.</p>

<p>We’re using an instance variable here for a very good reason: instance variables are automatically shared from controllers into views. So to use this <code class="language-plaintext highlighter-rouge">@articles</code> variable in our view to show all the articles, we can write this code in <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>We’ve now changed this file from using just HTML to using HTML and <em>ERB</em>. ERB is a language that we can use to run Ruby code.</p>

<p>There’s two types of ERB tag beginnings that we’re using here: <code class="language-plaintext highlighter-rouge">&lt;%</code> and <code class="language-plaintext highlighter-rouge">&lt;%=</code>. The <code class="language-plaintext highlighter-rouge">&lt;%</code> tag means to evalulate some Ruby code, while the <code class="language-plaintext highlighter-rouge">&lt;%=</code> means to evalulate that code, and then to output the return value from that code.</p>

<p>In this view, we do not want the output of <code class="language-plaintext highlighter-rouge">articles.each</code> to show, and so we use a <code class="language-plaintext highlighter-rouge">&lt;%</code>. But we do want each of the articles’ titles to appear, and so we use <code class="language-plaintext highlighter-rouge">&lt;%=</code>.</p>

<p>When we start an ERB tag with either <code class="language-plaintext highlighter-rouge">&lt;%</code> or <code class="language-plaintext highlighter-rouge">&lt;%=</code>, it can help to think “I am now writing Ruby, not HTML”. Anything you could write in a regular Ruby program, can go inside these ERB tags.</p>

<p>When the view is used by Rails, the embedded Ruby will be evalulated, and the page will show our list of articles. Let’s go to <a href="http://localhost:3000">http://localhost:3000</a> now and see the list of articles:</p>

<p><img src="/images/getting_started/article_list.png" alt="List of articles" /></p>

<p>If we look at the source of the page in our browser &lt;view-source:http://localhost:3000/&gt;, we’ll see this part:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>Hello Rails<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span>Post #2<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>This is the HTML that has been output from our view in our Rails application.</p>

<p>Here’s what’s happened to get to this point:</p>

<ol>
  <li>Our browser makes a request: <code class="language-plaintext highlighter-rouge">GET http://localhost:3000</code></li>
  <li>The Rails application receives this request</li>
  <li>The router sees that the <code class="language-plaintext highlighter-rouge">root</code> route is configured to route to the <code class="language-plaintext highlighter-rouge">ArticlesController</code>’s <code class="language-plaintext highlighter-rouge">index</code> action</li>
  <li>The <code class="language-plaintext highlighter-rouge">index</code> action uses the <code class="language-plaintext highlighter-rouge">Article</code> model to find all the articles</li>
  <li>Rails automatically renders the <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code> view</li>
  <li>The view contains ERB (Embedded Ruby). This code is evalulated, and plain HTML is returned.</li>
  <li>The server sends a response containing that plain HTML back to the browser.</li>
</ol>

<p>Here’s a flowchart of the above steps:</p>

<p><img src="/images/getting_started/application_flowchart.png" alt="Application flowchart" /></p>

<p>We’ve now successfully connected all the different parts of our Rails application together: the router, the controller, the action, the model and the view. With this connection, we have finished the first action of our application.</p>

<p>Let’s move on to the second action!</p>

<h3 id="viewing-an-article">Viewing an Article</h3>

<p>For our second action, we want our application to show us the details about an article, specifically the article’s title and body:</p>

<p><img src="/images/getting_started/single_article_view.png" alt="Single Article View" /></p>

<p>We’ll start in the same place we started with the <code class="language-plaintext highlighter-rouge">index</code> action, which was in <code class="language-plaintext highlighter-rouge">config/routes.rb</code>. We’ll add a new route for this page. Let’s change our routes file now to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This route is another <code class="language-plaintext highlighter-rouge">get</code> route, but it has something different in it: <code class="language-plaintext highlighter-rouge">:id</code>. This syntax in Rails routing is called a <em>parameter</em>, and it will be available in the <code class="language-plaintext highlighter-rouge">show</code> action of <code class="language-plaintext highlighter-rouge">ArticlesController</code> when a request is made. A request to this action will use a route such as <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a> or <a href="http://localhost:3000/articles/2">http://localhost:3000/articles/2</a>.</p>

<p>This time, we’re still routing to the <code class="language-plaintext highlighter-rouge">ArticlesController</code>, but we’re going to the <code class="language-plaintext highlighter-rouge">show</code> action of that controller instead of the <code class="language-plaintext highlighter-rouge">index</code> action.</p>

<p>Let’s look at how to add that <code class="language-plaintext highlighter-rouge">show</code> action to the <code class="language-plaintext highlighter-rouge">ArticlesController</code>. We’ll open <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code> and add it in, under the <code class="language-plaintext highlighter-rouge">index</code> action:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When a request is made to this <code class="language-plaintext highlighter-rouge">show</code> action, it will be made to a URL such as <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>. Rails sees that the last part of that route is a dynamic parameter, and makes that parameter available for us in our controller through the method <code class="language-plaintext highlighter-rouge">params</code>. We use <code class="language-plaintext highlighter-rouge">params[:id]</code> to access that parameter, because back in the routes file we called the parameter <code class="language-plaintext highlighter-rouge">:id</code>. If we used a name like <code class="language-plaintext highlighter-rouge">:article_id</code> in the routes file, then we would need to use <code class="language-plaintext highlighter-rouge">params[:article_id]</code> here too.</p>

<p>The <code class="language-plaintext highlighter-rouge">show</code> action finds a particular article with that ID. Once it has that, it needs to then display that article’s information, which will do by attempting to use a view at <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code>. Let’s create that file now and add this content:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Now when we go to <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a> we will see the article:</p>

<p><img src="/images/getting_started/single_article_view.png" alt="Single Article View" /></p>

<p>Excellent! We now have our second action working in our controller. But in order to navigate to it, we have to manually type in <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>. That seems a bit silly. Let’s change our application a little, so that we can navigate to an article by clicking a link from the list of articles.</p>

<p>To add the link to an article, we need to change <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>, which currently looks like this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>This code will render an <code class="language-plaintext highlighter-rouge">li</code> element for each of the articles, and that element contains the title of the article. But we can’t click on the title to go to an article yet! To make that happen, we need to use an <code class="language-plaintext highlighter-rouge">a</code> tag:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'/articles/</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">'</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">a</code> tag will provide us with a link to the specific article. If we go back to <a href="http://localhost:3000/">http://localhost:3000/</a>, we’ll see that we can now click on the articles:</p>

<p><img src="/images/getting_started/articles_list_with_links.png" alt="Articles list with links" /></p>

<p>Clicking either of these links will take us to the relevant article:</p>

<p><img src="/images/getting_started/single_article_view.png" alt="Single Article View" /></p>

<p>Now we have been able to link together the <code class="language-plaintext highlighter-rouge">index</code> and <code class="language-plaintext highlighter-rouge">show</code> pages in our application using a simple <code class="language-plaintext highlighter-rouge">a</code> tag. What could be simpler than that?</p>

<p>Well, Rails has a method called <code class="language-plaintext highlighter-rouge">link_to</code> that can make that linking a little simpler. Let’s use this in <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="s2">"/articles/</span><span class="si">#{</span><span class="n">article</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">"</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>There we go, that is now a little bit cleaner. Rails has given us a way to shorten this code a little. But what you don’t know yet is that this line can be made even simpler.</p>

<p>Rails has a feature called <em>routing helpers</em>. These are methods that can be used to generate route paths like <code class="language-plaintext highlighter-rouge">"/articles/#{article.id}"</code> programatically. We’ll use one of these to generate the route for our article. To set this up, let’s go back to <code class="language-plaintext highlighter-rouge">config/routes.rb</code> and change this line:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span>
</code></pre></div></div>

<p>To this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">:as</code> option here tells Rails that we want routing helpers for this article route to be available in our application. Rails will then let us use this helper to build that route.</p>

<p>Let’s look at how we can use that in <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code> now, by changing the end of the <code class="language-plaintext highlighter-rouge">link_to</code> call to this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">link_to</code> now assembles its path using the <code class="language-plaintext highlighter-rouge">article_path</code> helper. This will still generate the same <code class="language-plaintext highlighter-rouge">/articles/:id</code> route we used earlier, but now it happens programatically instead. Now there is not so much switching happening between HTML and Ruby in this code. We enter Ruby, generate a link, and exit Ruby. The code still does the same thing: it links an article’s title to the <code class="language-plaintext highlighter-rouge">show</code> page for that article.</p>

<p>TIP: To learn more about routing, read the <a href="https://guides.rubyonrails.org/routing.html">Rails Routing from the Outside In Guide</a>.</p>

<p>We now have an <code class="language-plaintext highlighter-rouge">index</code> action that lists the articles, and a <code class="language-plaintext highlighter-rouge">show</code> action that shows the title and body for a specific article. Before we move on, we’ll make one more little change: we’ll add a “Back” link in <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Back"</span><span class="p">,</span> <span class="s2">"/"</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

</code></pre></div></div>

<p>This will allow us to navigate back to the list of articles easily.</p>

<p>With that small change done, let’s now look at how we can create new articles within this application.</p>

<h3 id="creating-new-articles">Creating new articles</h3>

<p>To have a place to create new articles in our application, we’re going to need create a new route, action and view. On that view, we’re going to have this form:</p>

<p>IMAGE GOES HERE</p>

<p>Let’s start with the route:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This place to create new articles will be <code class="language-plaintext highlighter-rouge">/articles/new</code>, and the route for this has <em>very</em> intentionally been placed above the route for the <code class="language-plaintext highlighter-rouge">show</code> action. The reason for this is because routes in a Rails application are matched top-to-bottom. If we had <code class="language-plaintext highlighter-rouge">/articles/:id</code> first, that route would match <code class="language-plaintext highlighter-rouge">/articles/new</code>, and so if we went to <code class="language-plaintext highlighter-rouge">/articles/new</code>, the <code class="language-plaintext highlighter-rouge">show</code> action would serve that request, not the <code class="language-plaintext highlighter-rouge">new</code> action. And so for this reason, we put the <code class="language-plaintext highlighter-rouge">new</code> route <em>above</em> the <code class="language-plaintext highlighter-rouge">show</code> action.</p>

<p>This <code class="language-plaintext highlighter-rouge">/articles/new</code> route will send the request to the <code class="language-plaintext highlighter-rouge">new</code> action within the <code class="language-plaintext highlighter-rouge">ArticlesController</code>, which we’ll see in a minute. We’ve added the <code class="language-plaintext highlighter-rouge">:as</code> option here, as we will be using the <code class="language-plaintext highlighter-rouge">new_article_path</code> helper in a little while to provide a way to navigate to this form.</p>

<p>If we were to attempt to go to this route now, would see an error for the first time:</p>

<p><img src="/images/getting_started/unknown_action_new_for_articles.png" alt="Unknown action new for ArticlesController!" /></p>

<p>This error indicates that Rails cannot find the <code class="language-plaintext highlighter-rouge">new</code> action inside the
<code class="language-plaintext highlighter-rouge">ArticlesController</code>. No worries, we will need to define this action.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can put the <code class="language-plaintext highlighter-rouge">new</code> action under <code class="language-plaintext highlighter-rouge">show</code> in the controller, because the order of methods in classes doesn’t matter in Ruby.</p>

<p>With the <code class="language-plaintext highlighter-rouge">new</code> method defined in <code class="language-plaintext highlighter-rouge">ArticlesController</code>, if you refresh
<a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> you’ll see another error:</p>

<p><img src="/images/getting_started/template_is_missing_articles_new.png" alt="Template is missing for articles/new" /></p>

<p>You’re getting this error now because Rails expects empty actions like this one to have views associated with them to display their information. With no view available, Rails will raise an exception.</p>

<p>Let’s look at the full error message again:</p>

<blockquote>
  <p>ArticlesController#new is missing a template for request formats: text/html</p>
</blockquote>

<blockquote>
  <p>NOTE!
Unless told otherwise, Rails expects an action to render a template with the same name, contained in a folder named after its controller. If this controller is an API responding with 204 (No Content), which does not require a template, then this error will occur when trying to access it via browser, since we expect an HTML template to be rendered for such requests. If that’s the case, carry on.</p>
</blockquote>

<p>The message identifies which template is missing. In this case, it’s the
<code class="language-plaintext highlighter-rouge">articles/new</code> template. Next the message contains <code class="language-plaintext highlighter-rouge">request.formats</code> which specifies the format of template to be served in response. It is set to <code class="language-plaintext highlighter-rouge">text/html</code> as we requested this page via browser, so Rails is looking for an HTML template.</p>

<p>The simplest template that would work in this case would be one located at <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code>. The extension of this file name is important: the first extension is the <em>format</em> of the template, and the second extension is the <em>handler</em> that will be used to render the template.  Think of it reading right-to-left: “I’m going to <em>execute ERB</em> to <em>generate HTML</em> for the <em><code class="language-plaintext highlighter-rouge">new</code> action</em>”.</p>

<p>So let’s now go ahead now and create a new file at <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> and write this content in it:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<p>To create a form within this template, you will use a <em>form
builder</em>. The primary form builder for Rails is provided by a helper
method called <code class="language-plaintext highlighter-rouge">form_with</code>. To use this method, add this code into
<code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"title"</span> <span class="na">name=</span><span class="s">"title"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"text"</span><span class="nt">&gt;</span>Text<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"text"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Save Article"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>This is an awful lot of typing for building a form. Fortunately, Rails provides helpers for us to simplify matters:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">form_with</code> helper method allows us to build a form. The first line of this provides us a block argument called <code class="language-plaintext highlighter-rouge">form</code>, and then throughout the form we use that to build labels and text inputs for our field.</p>

<p>NOTE: By default <code class="language-plaintext highlighter-rouge">form_with</code> submits forms using Ajax thereby skipping full page redirects. To make this guide easier to get into we’ve disabled that with <code class="language-plaintext highlighter-rouge">local: true</code> for now.</p>

<p>This ERB code that uses <code class="language-plaintext highlighter-rouge">form_with</code> will output a HTML form that looks very similar to the one we hand-rolled, but there are some key differences. Here’s what the <code class="language-plaintext highlighter-rouge">form_with</code> outputs:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/new"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"DIwa34..."</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">id=</span><span class="s">"article_title"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_text"</span><span class="nt">&gt;</span>Text<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"article[text]"</span> <span class="na">id=</span><span class="s">"article_text"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/textarea&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Save Article"</span> <span class="na">data-disable-with=</span><span class="s">"Save Article"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>The first key difference is that there is a hidden field called <code class="language-plaintext highlighter-rouge">authenticity_token</code> at the top. This is a security feature of Rails and it prevents outside people from submitting your forms maliciously using a technique called Cross Site Request Forgery. <a href="https://stackoverflow.com/a/1571900/15245">This Stack Overflow answer explains further</a>.</p>

<p>The labels and fields are mostly the way they were, with a key difference: the <code class="language-plaintext highlighter-rouge">name</code> fields have an <code class="language-plaintext highlighter-rouge">article[]</code> wrapping around their values. This wrapping comes from the <code class="language-plaintext highlighter-rouge">scope</code> argument that we have passed to <code class="language-plaintext highlighter-rouge">form_with</code>. This wrapping groups all the fields of the form into one hash once they’re submitted, and that will make it easy to process once they reach our application.</p>

<p>Speaking of, let’s try and fill out this form now with a title and a body for our 3rd article:</p>

<p><img src="/images/getting_started/article_the_third.png" alt="The third article" /></p>

<p>There’s one problem with this form though. If you inspect the HTML that is generated, by viewing the source of the page, you will see that the <code class="language-plaintext highlighter-rouge">action</code> attribute for the form is pointing at <code class="language-plaintext highlighter-rouge">/articles/new</code>. This is a problem because this route goes to the very page that you’re on right at the moment, and that route should only be used to display the form for a new article.</p>

<p>The form needs to use a different URL in order to go somewhere else.
This can be done quite simply with the <code class="language-plaintext highlighter-rouge">:url</code> option of <code class="language-plaintext highlighter-rouge">form_with</code>.
Typically in Rails, the action that is used for new form submissions
like this is called “create”, and so the form should be pointed to that action.</p>

<p>Edit the <code class="language-plaintext highlighter-rouge">form_with</code> line inside <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> to look like this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">url: </span><span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Once the form is submitted, it will send a <code class="language-plaintext highlighter-rouge">POST</code> request to <code class="language-plaintext highlighter-rouge">/articles</code>. If we hit submit on that form now, we’ll be shown a Routing Error:</p>

<p><img src="/images/getting_started/routing_error_post_articles.png" alt="Routing Error" /></p>

<p>This error means that we haven’t set up a route to handle <code class="language-plaintext highlighter-rouge">POST</code> requests to <code class="language-plaintext highlighter-rouge">/articles</code>. If we look in our <code class="language-plaintext highlighter-rouge">config/routes.rb</code> file, we’ll see that is correct:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article_path</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Let’s add this new route now:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article_path</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
  <span class="n">post</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#create"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>TIP: The <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">post</code> methods that we use in <code class="language-plaintext highlighter-rouge">config/routes.rb</code> match HTTP request methods. These methods are conventions used across all HTTP applications – not just Rails! – to clearly indicate what sort of action we want to do. A <code class="language-plaintext highlighter-rouge">GET</code> request is one that retrieves information. A <code class="language-plaintext highlighter-rouge">POST</code> request is one that <em>adds</em> information. For more detials on these, see this MDN article: https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods.</p>

<p>When Rails receives a <code class="language-plaintext highlighter-rouge">POST /articles</code> request, it will now route that request to the <code class="language-plaintext highlighter-rouge">create</code> action of the <code class="language-plaintext highlighter-rouge">ArticlesController</code>. However, if we re-submit that form, we’ll see that the action cannot be found:</p>

<p><img src="images/getting_started/unknown_action_create_for_articles.png" alt="Unknown action create for ArticlesController" /></p>

<p>You now need to create the <code class="language-plaintext highlighter-rouge">create</code> action within the <code class="language-plaintext highlighter-rouge">ArticlesController</code> for this to work.</p>

<h3 id="creating-articles">Creating Articles</h3>

<p>To make the “Unknown action” go away, we can define a <code class="language-plaintext highlighter-rouge">create</code> action within the <code class="language-plaintext highlighter-rouge">ArticlesController</code> class in <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code>, underneath the <code class="language-plaintext highlighter-rouge">new</code> action, as shown:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you re-submit the form now, you may not see any change on the page. Don’t worry!</p>

<p>This is because Rails by default returns <code class="language-plaintext highlighter-rouge">204 No Content</code> response for an action if we don’t specify what the response should be. We just added the <code class="language-plaintext highlighter-rouge">create</code> action but didn’t specify anything about how the response should be. In this case, the <code class="language-plaintext highlighter-rouge">create</code> action should save our new article to the database.</p>

<p>When a form is submitted, the fields of the form are sent to Rails as
<em>parameters</em>. Yes, there are the same parameters as we saw earlier when we used <code class="language-plaintext highlighter-rouge">params[:id]</code>. These parameters can then be referenced inside the controller actions, typically to perform a particular task. To see what these parameters look like, change the <code class="language-plaintext highlighter-rouge">create</code> action to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="n">render</span> <span class="ss">plain: </span><span class="n">params</span><span class="p">[</span><span class="ss">:article</span><span class="p">].</span><span class="nf">inspect</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">render</code> method here is taking a very simple hash with a key of <code class="language-plaintext highlighter-rouge">:plain</code> and value of <code class="language-plaintext highlighter-rouge">params[:article].inspect</code>. The <code class="language-plaintext highlighter-rouge">params</code> method is the object which represents the parameters (or fields) coming in from the form. The <code class="language-plaintext highlighter-rouge">params</code> method returns an <code class="language-plaintext highlighter-rouge">ActionController::Parameters</code> object, which allows you to access the keys of the hash using either strings or symbols. In this situation, the only parameters that matter are the ones from the form. Thanks to the use of the <code class="language-plaintext highlighter-rouge">scope</code> option on the form, all of our form’s parameters are grouped under <code class="language-plaintext highlighter-rouge">params[:article]</code>.</p>

<p>TIP: Ensure you have a firm grasp of the <code class="language-plaintext highlighter-rouge">params</code> method, as you’ll use it fairly regularly. Let’s consider an example URL: <strong>http://www.example.com/?username=dhh&amp;email=dhh@email.com</strong>. In this URL, <code class="language-plaintext highlighter-rouge">params[:username]</code> would equal “dhh” and <code class="language-plaintext highlighter-rouge">params[:email]</code> would equal “dhh@email.com”.</p>

<p>If you re-submit the form one more time, you’ll see something that looks like the following:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"title"</span><span class="o">=&gt;</span><span class="s2">"Article the Third"</span><span class="p">,</span> <span class="s2">"text"</span><span class="o">=&gt;</span><span class="s2">"The Trilogy Ends"</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">false</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>This action is now displaying the parameters for the article that are coming in from the form. However, this isn’t really all that helpful. Yes, you can see the parameters but nothing in particular is being done with them.</p>

<p>Let’s change the  <code class="language-plaintext highlighter-rouge">create</code> action to use the <code class="language-plaintext highlighter-rouge">Article</code> model to save the data in the database. Let’s change the <code class="language-plaintext highlighter-rouge">create</code> action to look like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article</span><span class="p">])</span>
  <span class="n">article</span><span class="p">.</span><span class="nf">save</span>

  <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE: We’re <em>not</em> using an instance variable in this action. This is because this action redirects at the end, and since there is a redirection there is no view. So there is no need to make these variables instance variables.</p>

<p>Here we use some familar code to create a new article – we saw this previously right after we generated the <code class="language-plaintext highlighter-rouge">Article</code> model. The call to <code class="language-plaintext highlighter-rouge">new</code> and then to <code class="language-plaintext highlighter-rouge">save</code> will create a new article record in the database.</p>

<p>The final line, a <code class="language-plaintext highlighter-rouge">redirect_to</code>, uses <code class="language-plaintext highlighter-rouge">article_path</code> to redirect back to the <code class="language-plaintext highlighter-rouge">show</code> action.</p>

<p>If you now go to <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> you’ll <em>almost</em> be able to create an article. Try it! You should get an error that looks like this:</p>

<p><img src="images/getting_started/forbidden_attributes_for_new_article.png" alt="Forbidden attributes for new article" /></p>

<p>Rails has several security features that help you write secure applications, and you’re running into one of them now. This one is called <a href="action_controller_overview.html#strong-parameters">strong parameters</a>,
which requires us to tell Rails exactly which parameters are allowed into our controller actions.</p>

<p>Why do you have to bother? The ability to grab and automatically assign all controller parameters to your model in one shot makes the programmer’s job easier, but this convenience also allows malicious use. What if this form was a bank account and we allowed just anyone to add in a new field that set their balance to whatever they wished? This would end up bad for us!</p>

<p>We have to define our permitted controller parameters to prevent wrongful mass assignment. In this case, we want to both allow and require the <code class="language-plaintext highlighter-rouge">title</code> and <code class="language-plaintext highlighter-rouge">body</code> parameters for valid use of <code class="language-plaintext highlighter-rouge">create</code>. The syntax for this introduces <code class="language-plaintext highlighter-rouge">require</code> and <code class="language-plaintext highlighter-rouge">permit</code>. The change will involve one line in the <code class="language-plaintext highlighter-rouge">create</code> action:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">))</span>
</code></pre></div></div>

<p>This code is quite long and is often pulled out into its own method so it can be reused by multiple actions in the same controller. Above and beyond mass assignment issues, the method is often made <code class="language-plaintext highlighter-rouge">private</code> to make sure it can’t be called outside its intended context. Here is the result:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">redirect_to</span> <span class="vi">@article</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">article_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>TIP: For more information, refer to the reference above and
[this blog article about Strong Parameters]
(https://weblog.rubyonrails.org/2012/3/21/strong-parameters/).</p>

<p>If we attempt to submit our form once more, this time it will succeed and we’ll see the article’s title and body. The URL should be <a href="http://localhost:3000/articles/3">http://localhost:3000/articles/3</a>, indicating that we’re now on the <code class="language-plaintext highlighter-rouge">show</code> action.</p>

<p>Before we wrap up this section, let’s add a link to <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code> so that we can go to the “New Article” page from there:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>Now we’ll have an easy link to go back to that page:</p>

<p><img src="/images/getting_started/three_articles.png" alt="Three articles" /></p>

<p>Great! That’s another two actions finished in our controller: <code class="language-plaintext highlighter-rouge">new</code> and <code class="language-plaintext highlighter-rouge">create</code>.</p>

<h3 id="adding-some-validation">Adding Some Validation</h3>

<p>Sometimes, in web applications, we want to make sure certain fields are filled in.</p>

<p>The model file, <code class="language-plaintext highlighter-rouge">app/models/article.rb</code> is about as simple as it can get:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There isn’t much to this file - but note that the <code class="language-plaintext highlighter-rouge">Article</code> class inherits from
<code class="language-plaintext highlighter-rouge">ApplicationRecord</code>. <code class="language-plaintext highlighter-rouge">ApplicationRecord</code> inherits from <code class="language-plaintext highlighter-rouge">ActiveRecord::Base</code> which supplies a great deal of functionality to your Rails models for free. We’ve used some of this already: <code class="language-plaintext highlighter-rouge">Article.new</code>, <code class="language-plaintext highlighter-rouge">Article.all</code>, <code class="language-plaintext highlighter-rouge">Article.find</code> and so on.</p>

<p>One of these pieces of functionality is that Active Record includes methods to help you validate the data that you send to models and it’s easy to use.</p>

<p>Open the <code class="language-plaintext highlighter-rouge">app/models/article.rb</code> file and edit it to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>These changes will ensure that all articles have a title that is at least five characters long. Rails can validate a variety of conditions in a model, including the presence or uniqueness of columns, their format, and the existence of associated objects. Validations are covered in detail in <a href="active_record_validations.html">Active Record Validations</a>.</p>

<p>This validation will now only let us save articles that have titles longer than 5 characters. Let’s open up the console now and try:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails console
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">invalid_article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Article id: nil, title: nil, body: nil, created_at: nil, updated_at: nil&gt;</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">invalid_article</span><span class="p">.</span><span class="nf">save</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
</code></pre></div></div>

<p>When <code class="language-plaintext highlighter-rouge">save</code> returns <code class="language-plaintext highlighter-rouge">false</code>, it means that the object is invalid and won’t be saved to the database. To find out why, we can use this code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">invalid_article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"Title can't be blank"</span><span class="p">,</span> <span class="s2">"Title is too short (minimum is 5 characters)"</span><span class="p">]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">errors.full_messages</code> method chain shows two validation failure messages for our model:</p>

<ul>
  <li>The title can’t be blank</li>
  <li>The title is too short (minimum of 5 characters)</li>
</ul>

<p>That’s because we’ve left the title blank. Now let’s see what happens when we save an article with a valid title:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>irb(main):006:0&gt; article = Article.new title: "Getting Started"
=&gt; #&lt;Article id: nil, title: "Getting Started", body: nil, created_at: nil, updated_at: nil&gt;

irb(main):007:0&gt; article.save
   (0.1ms)  begin transaction
  Article Create (0.4ms)  INSERT INTO "articles" ("title", "created_at", "updated_at") VALUES (?, ?, ?)  [["title", "Getting Started"], ["created_at", "2020-01-19 09:56:25.693465"], ["updated_at", "2020-01-19 09:56:25.693465"]]
   (0.6ms)  commit transaction
=&gt; true
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">save</code> call here has returned <code class="language-plaintext highlighter-rouge">true</code>, indicating that the article has passed validations. Also in the console, we can see an <code class="language-plaintext highlighter-rouge">Article Create</code> message, that contains an <code class="language-plaintext highlighter-rouge">INSERT INTO</code> database query, and so we can be confident that this article has now been inserted into our database.</p>

<p>Now that we’ve seen how to handle invalid and valid articles in the console, let’s try using this same technique in our controller.</p>

<p>If you open
<code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code> again, you’ll notice that we don’t check the result of calling <code class="language-plaintext highlighter-rouge">@article.save</code> inside the <code class="language-plaintext highlighter-rouge">create</code> action.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">redirect_to</span> <span class="vi">@article</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">@article.save</code> fails in this situation, we need to do something different: we need to show the form again to the user so that they can correct their mistake.</p>

<p>To do this, let’s change the <code class="language-plaintext highlighter-rouge">create</code> action to either redirect to the article if the save was successful (the method returns <code class="language-plaintext highlighter-rouge">true</code>) or to show the new form again if the save failed:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The first thing to note here is that we’ve now switched from using a local variable <code class="language-plaintext highlighter-rouge">article</code> to using an instance variable, <code class="language-plaintext highlighter-rouge">@article</code>. The reason for this is the <code class="language-plaintext highlighter-rouge">else</code> statement. Inside that <code class="language-plaintext highlighter-rouge">else</code> we tell Rails to <code class="language-plaintext highlighter-rouge">render 'new'</code>. This tells Rails that we want the <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> view to be rendered in the case where our save fails.</p>

<p>If you reload <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> and
try to save an article without a title, Rails will send you back to the
form, but that’s not very useful. It doesn’t tell us why something went wrong. To do that, we’ll need to modify <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> to check for error messages:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">url: </span><span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited
        this article from being saved:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>At the top of this view, we’re now using <code class="language-plaintext highlighter-rouge">@article.errors</code> to check for any errors. The <code class="language-plaintext highlighter-rouge">@article</code> variable here will come from the <code class="language-plaintext highlighter-rouge">create</code> action, when the <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> view is rendered due to an invalid article.</p>

<p>Inside the check for any errors, we call <code class="language-plaintext highlighter-rouge">pluralize</code>. <code class="language-plaintext highlighter-rouge">pluralize</code> is a rails helper that takes a number and a string as its arguments. If the number is greater than one, the string will be automatically
pluralized.</p>

<p>If we attempt to go to <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> at this point, we’ll see it fail:</p>

<p><img src="images/getting_started/no_method_in_form.png" alt="NoMethodError" /></p>

<p>This is happening because we’re referring to a variable called <code class="language-plaintext highlighter-rouge">@article</code> within <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code>, but the <code class="language-plaintext highlighter-rouge">new</code> action does not provide this variable at all.</p>

<p>The path to this error is:</p>

<ol>
  <li>Browser goes to http://localhost:3000/articles/new</li>
  <li>Rails sees <code class="language-plaintext highlighter-rouge">/articles/new</code> is the route, routes the request to the <code class="language-plaintext highlighter-rouge">ArticlesController</code>’s <code class="language-plaintext highlighter-rouge">new</code> action</li>
  <li>The <code class="language-plaintext highlighter-rouge">new</code> action is blank, and so Rails defaults to rendering <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code>.</li>
  <li>The template attempts to reference <code class="language-plaintext highlighter-rouge">@article</code>, but it is not defined.</li>
</ol>

<p>So to make this error go away, we need to define this <code class="language-plaintext highlighter-rouge">@article</code> variable. We can do it like this in the <code class="language-plaintext highlighter-rouge">new</code> action inside <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">@article</code> is a brand-new <code class="language-plaintext highlighter-rouge">Article</code> object, and will be perfect for our form. It doesn’t have any errors on it – because we haven’t tried saving it yet! – and so the form will not display any errors.</p>

<p>If we refresh this <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> page, we should see our form renders once again.</p>

<p><img src="images/getting_started/new_article.png" alt="The form works again" /></p>

<p>Now you’ll get a nice error message when saving an article without a title when
you attempt to do just that on the new article form
<a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>:</p>

<p><img src="images/getting_started/form_with_errors.png" alt="Form With Errors" /></p>

<p>And there we have it! We now have the ability to create new articles within our application.</p>

<h3 id="updating-articles">Updating Articles</h3>

<p>Now what should happen if we make a mistake when creating an article? Well, we should have a way to edit an article and correct that mistake.</p>

<p>Our edit form will look just like our new form, just with a few differences:</p>

<p><img src="/images/getting_started/edit_form.png" alt="Edit form" /></p>

<p>Firstly, the title will say “Edit Article”, not “New Article”. Secondly, the fields will be filled out with the article’s current values. And lastly, the submit button says “Update Article”, not “Save Article”.</p>

<p>To add this feature to our application, we’re going to need to add a new route, a route just for editing articles. Let’s do this now in <code class="language-plaintext highlighter-rouge">config/routes.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="s2">"/articles/:id/edit"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#edit"</span><span class="p">,</span> <span class="ss">as: :edit_article</span>
</code></pre></div></div>

<p>This new route is another <code class="language-plaintext highlighter-rouge">get</code> route. This time, we’re routing to <code class="language-plaintext highlighter-rouge">/articles/:id/edit</code>, so that we can see that edit form for a particular article. Which article we’re editing depends on that <code class="language-plaintext highlighter-rouge">:id</code> parameter in the route.</p>

<p>The route will be handled by the <code class="language-plaintext highlighter-rouge">edit</code> action within <code class="language-plaintext highlighter-rouge">ArticlesController</code>. We’ll add that action soon.</p>

<p>The <code class="language-plaintext highlighter-rouge">as</code> option will provide us with a routing helper that we can use across our application to take us to this edit form for a specific article.</p>

<p>As a first step, let’s add an “Edit” link for each article on <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>This “Edit” link will now appear next to all of the articles at <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>.</p>

<p><img src="/images/getting_started/articles_with_edit.png" alt="Articles with edit links" /></p>

<p>If we click on any one of those “Edit” links, we’ll see that we haven’t yet defined the <code class="language-plaintext highlighter-rouge">edit</code> action.</p>

<p><img src="/images/getting_started/no_edit_action.png" alt="No edit action" /></p>

<p>So the next step here is to add that action to our controller. Let’s open <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code> and add that action:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">edit</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
<span class="k">end</span>
</code></pre></div></div>

<p>NOTE:  We’re using <code class="language-plaintext highlighter-rouge">edit</code> to render just a form to display the current values of the article. For the actual updating of the article, we’ll use a different action for this shortly called <code class="language-plaintext highlighter-rouge">update</code>.</p>

<p>The view will contain a form similar to the one we used when creating new articles. Create a file called <code class="language-plaintext highlighter-rouge">app/views/articles/edit.html.erb</code> and put this content inside:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited
        this article from being saved:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>The only things different in this view are the <code class="language-plaintext highlighter-rouge">&lt;h1&gt;</code> at the top of the view, and the <code class="language-plaintext highlighter-rouge">form_with</code>. The <code class="language-plaintext highlighter-rouge">form_with</code> is not using <code class="language-plaintext highlighter-rouge">scope</code> or <code class="language-plaintext highlighter-rouge">url</code>, but is instead using a different key called <code class="language-plaintext highlighter-rouge">model</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">model</code> key for <code class="language-plaintext highlighter-rouge">form_with</code> takes an instance of a model’s class and builds a form for that particular object. By using <code class="language-plaintext highlighter-rouge">form_with</code> in this way, Rails will pre-populate the title and body fields in this form for us.</p>

<p>There’s one extra feature that Rails does for us that is not immediately obvious from looking at the form itself. This feature requires us to look at the HTML source of this form. Inside this source at the top of the <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> element, here’s what we’ll see:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/1"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Firstly, the <code class="language-plaintext highlighter-rouge">action</code> attribute for this form goes to a route called <code class="language-plaintext highlighter-rouge">/articles/1</code>. This path was automatically generated by Rails; in short: it uses the <code class="language-plaintext highlighter-rouge">article_path</code> helper to generate this route. The second thing to notice is that hidden field. This hidden field is a special field that will make the form do a <code class="language-plaintext highlighter-rouge">PATCH</code> request when this form is submitted, instead of the default <code class="language-plaintext highlighter-rouge">POST</code> (as is configured in the <code class="language-plaintext highlighter-rouge">form</code> element’s <code class="language-plaintext highlighter-rouge">method</code> attribute).</p>

<p>This means that our form will make a <code class="language-plaintext highlighter-rouge">PATCH /articles/1</code> request when it is submitted. If we hit submit on the form, we’ll see that this is correct, and that this route is currently missing:</p>

<p><img src="/images/getting_started/no_route_for_patch_articles.png" alt="No route matches [PATCH] &quot;/articles/1&quot;" /></p>

<p>This route is supposed to handle the submission of our form, but the route does not exist yet. To make this form work, we’ll need to define this route. Let’s go back to <code class="language-plaintext highlighter-rouge">config/routes.rb</code> and define this route:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
  <span class="n">post</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#create"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id/edit"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#edit"</span><span class="p">,</span> <span class="ss">as: :edit_article</span>
  <span class="n">patch</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#update"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">patch</code> method will generate us a route for <code class="language-plaintext highlighter-rouge">PATCH /articles/:id</code> requests. We use the <code class="language-plaintext highlighter-rouge">PATCH</code> HTTP routing method for when we want to modify an existing resource.</p>

<p>These requests to <code class="language-plaintext highlighter-rouge">PATCH /articles/:id</code> will be routed to the <code class="language-plaintext highlighter-rouge">update</code> action in our <code class="language-plaintext highlighter-rouge">ArticlesController</code>. Let’s add that action now underneath the <code class="language-plaintext highlighter-rouge">edit</code> action:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">edit</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">update</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'edit'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">article_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>The new method, <code class="language-plaintext highlighter-rouge">update</code>, is used when you want to update a record that already exists, and it accepts a hash containing the attributes that you want to update. As before, if there was an error updating the article we want to show the form back to the user.</p>

<p>We reuse the <code class="language-plaintext highlighter-rouge">article_params</code> method that we defined earlier for the create action. We want to accept the same parameters here, and so it makes sense to use the same <code class="language-plaintext highlighter-rouge">article_params</code> method.</p>

<p>TIP: It is not necessary to pass all the attributes to <code class="language-plaintext highlighter-rouge">update</code>. For example, if <code class="language-plaintext highlighter-rouge">@article.update(title: 'A new title')</code> was called, Rails would only update the <code class="language-plaintext highlighter-rouge">title</code> attribute, leaving all other attributes untouched.</p>

<p>Let’s try this again. We’ll go to <a href="http://localhost:3000">http://localhost:3000</a>, click the “Edit” link next to one of the articles and change its title. I’m going to change the “Hello Rails” article’s title to “Hello Rails, how are you today?”. When this happens and we submit the form, we will see the new title for that article:</p>

<p><img src="/images/getting_started/how_are_you_rails.png" alt="How are you, Rails?" /></p>

<p>On this page, we’re currently missing a way to edit an article. This route that we’re currently on is <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>, and we know that the route matches to <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code>.</p>

<p>This now finishes our adventures in adding the ability to edit an article in this application.</p>

<h3 id="using-partials-to-clean-up-duplication-in-views">Using partials to clean up duplication in views</h3>

<p>Our <code class="language-plaintext highlighter-rouge">edit</code> page looks very similar to the <code class="language-plaintext highlighter-rouge">new</code> page; in fact, they both share almost same code for displaying the form. Rails has yet another great feature that we can use to reduce this duplication and this feature is called <em>partials</em>.</p>

<p>Partials allow us to extract out comon pieces of views into a file that is then shared across many different views, or in this case, just two views. Let’s remove this
duplication by using a partial. By convention, partial files are
prefixed with an underscore.</p>

<p>TIP: You can read more about partials in the
<a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a> guide.</p>

<p>Create a new file <code class="language-plaintext highlighter-rouge">app/views/articles/_form.html.erb</code>. We’re going to copy <em>most</em> of <code class="language-plaintext highlighter-rouge">app/views/articles/edit.html.erb</code> into this new partial file:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited
        this article from being saved:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>This partial can now be used in both the <code class="language-plaintext highlighter-rouge">new</code> and <code class="language-plaintext highlighter-rouge">edit</code> views. Let’s update the new view:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'form'</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Then do the same for the <code class="language-plaintext highlighter-rouge">app/views/articles/edit.html.erb</code> view:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'form'</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">render</code> call in a view works differently to the <code class="language-plaintext highlighter-rouge">render</code> call in a controller. Back in the <code class="language-plaintext highlighter-rouge">create</code> action for <code class="language-plaintext highlighter-rouge">ArticlesController</code>, we have this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def create
  @article = Article.new(article_params)

  if @article.save
    redirect_to @article
  else
    render 'new'
  end
end
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">render</code> method call will render a <em>view</em>, not a partial. In this case, it will render the <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> view.</p>

<p>But when we call <code class="language-plaintext highlighter-rouge">render</code> inside a view, it will render a <em>partial</em>. When we call <code class="language-plaintext highlighter-rouge">render 'form', article: @article</code> inside our <code class="language-plaintext highlighter-rouge">new.html.erb</code> and <code class="language-plaintext highlighter-rouge">edit.html.erb</code> views, this will render the <code class="language-plaintext highlighter-rouge">app/views/articles/_form.html.erb</code> partial. How does Rails know that we want <em>this</em> particular form partial? It assumes we want the one in the same directory as the current view by default. This is another one of Rails’ conventions at work!</p>

<p>The <code class="language-plaintext highlighter-rouge">article: @article</code> syntax at the end of this line tells Rails that we want to pass the instance variable <code class="language-plaintext highlighter-rouge">@article</code> to the partial as a <em>local variable</em> called <code class="language-plaintext highlighter-rouge">article</code>.</p>

<p>Inside that partial, we can access whatever the current article is by using the <code class="language-plaintext highlighter-rouge">article</code> local variable.</p>

<p>Now, an interesting thing happens here. When this partial is rendered for the <code class="language-plaintext highlighter-rouge">new</code> action, the form will submit to the <code class="language-plaintext highlighter-rouge">create</code> action. But when it’s rendered for the <code class="language-plaintext highlighter-rouge">edit</code> action, it will submit to the <code class="language-plaintext highlighter-rouge">update</code> action. Go ahead and try it.</p>

<p>How can one piece of code do two things? The way this works lies in the magic of <code class="language-plaintext highlighter-rouge">form_with</code> and what it outputs, depending on its <code class="language-plaintext highlighter-rouge">model</code> option.</p>

<p>When this partial is rendered by the <code class="language-plaintext highlighter-rouge">new</code> action, the <code class="language-plaintext highlighter-rouge">@article</code> variable is set like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">form_with</code> helper from Rails detects that this object hasn’t yet been saved to the database, and therefore assumes we want to display a form for <em>creating</em> a new article. If you look at the HTML source from <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>, you’ll see the form is configured like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>When the form is submitted, it will make a <code class="language-plaintext highlighter-rouge">POST /articles</code> request. This will go to the <code class="language-plaintext highlighter-rouge">create</code> action in <code class="language-plaintext highlighter-rouge">ArticlesController</code>, because that’s how our routes are configured:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">post</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#create"</span>
</code></pre></div></div>

<p>Over in the <code class="language-plaintext highlighter-rouge">edit</code> action, we instead set <code class="language-plaintext highlighter-rouge">@article</code> like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">edit</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">@article</code> represents an article that has already been saved to the database, and so <code class="language-plaintext highlighter-rouge">form_with</code> behaves different. Let’s look at the HTML source from <a href="http://localhost:3000/articles/1/edit">http://localhost:3000/articles/1/edit</a> and see:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/1"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>This is the same <code class="language-plaintext highlighter-rouge">form_with</code> method call that is running, but it is acting differently. This time, the form is generated with an <code class="language-plaintext highlighter-rouge">action</code> of <code class="language-plaintext highlighter-rouge">/articles/1</code>. The hidden field called <code class="language-plaintext highlighter-rouge">_method</code> will make Rails do a <code class="language-plaintext highlighter-rouge">PATCH /articles/1</code> request. If we look in our routes file, we’ll see that such a request goes to the <code class="language-plaintext highlighter-rouge">update</code> action:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">patch</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#update"</span>
</code></pre></div></div>

<p>This is no coincidence. We have chosen these routes very specifically so that we can follow Rails conventions. The <code class="language-plaintext highlighter-rouge">form_with</code> helper acts differently depending on if the <code class="language-plaintext highlighter-rouge">@article</code> has been saved or not, and so we can use this one partial to represent a form in either <code class="language-plaintext highlighter-rouge">new.html.erb</code> or <code class="language-plaintext highlighter-rouge">edit.html.erb</code>.</p>

<p>Partials are a very handy feature of Rails that we can use to remove duplication between separate views. And combining them with <code class="language-plaintext highlighter-rouge">form_with</code> allows us to merge together two forms into one, without sacrificing any of our sanity.</p>

<h3 id="deleting-articles">Deleting Articles</h3>

<p>We’re now able to see, create, and update articles within our application. The final part that we’ll cover for articles in this guide is how to delete them.</p>

<p>In order to edit articles, we provided a link right next to the article’s title in <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code>. To delete articles, let’s do the same thing:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">link_to</code> won’t delete the article. It will instead take us to the <code class="language-plaintext highlighter-rouge">show</code> action in <code class="language-plaintext highlighter-rouge">ArticlesController</code> and show us the article itself. We need to add one extra thing to this link, which is a <code class="language-plaintext highlighter-rouge">method</code> option:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">),</span> <span class="ss">method: :delete</span>
<span class="cp">%&gt;</span>
</code></pre></div></div>

<p>This will make the link make a <code class="language-plaintext highlighter-rouge">DELETE /articles/:id</code> request. The <code class="language-plaintext highlighter-rouge">DELETE</code> HTTP method is one that we use when we want to delete things.</p>

<p>We can now refresh this page and click one of these “Delete” links. This request currently won’t work, because we don’t have a <code class="language-plaintext highlighter-rouge">DELETE /articles/:id</code> route set up:</p>

<p><img src="/images/getting_started/no_delete_route.png" alt="No delete route" /></p>

<p>Let’s add this route to <code class="language-plaintext highlighter-rouge">config/routes.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
  <span class="n">post</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#create"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id/edit"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#edit"</span><span class="p">,</span> <span class="ss">as: :edit_article</span>
  <span class="n">patch</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#update"</span>
  <span class="n">delete</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#destroy"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This route will now match <code class="language-plaintext highlighter-rouge">DELETE /articles/:id</code> requests and send them to the <code class="language-plaintext highlighter-rouge">destroy</code> action in <code class="language-plaintext highlighter-rouge">ArticlesController</code>. Let’s add this action now in the <code class="language-plaintext highlighter-rouge">ArticlesController</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">destroy</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="n">article</span><span class="p">.</span><span class="nf">destroy</span>

  <span class="n">redirect_to</span> <span class="n">articles_path</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The complete <code class="language-plaintext highlighter-rouge">ArticlesController</code> in the
<code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code> file should now look like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">destroy</span>

    <span class="n">redirect_to</span> <span class="s1">'/'</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can call <code class="language-plaintext highlighter-rouge">destroy</code> on model instances when you want to delete them from the database. Note that we don’t need to add a view for this action since we’re redirecting back to ‘/’ – the root of our application.</p>

<p>If we click “Delete” again on our list of articles, we’ll each article disappear in turn.</p>

<p>We might want to be a little mindful here and ask users if they’re <em>really</em> sure that they want to delete an article. Having a link so close to “Edit” like this is a recipe for disaster!</p>

<p>To prompt the user, we’re going to change the “Delete” link in <code class="language-plaintext highlighter-rouge">app/views/articles/index.html.erb</code> to this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete"</span><span class="p">,</span>
  <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">),</span>
  <span class="ss">method: :delete</span><span class="p">,</span>
  <span class="ss">data: </span><span class="p">{</span>
    <span class="ss">confirm: </span><span class="s2">"Are you sure you want to delete this article?"</span>
  <span class="p">}</span>
<span class="cp">%&gt;</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">data</code> option uses a feature of Rails called <em>Unobtrusive JavaScript</em>. By default, Rails applications come with a little bit of JavaScript for features like this.</p>

<p>TIP: Learn more about Unobtrusive JavaScript on
<a href="working_with_javascript_in_rails.html">Working With JavaScript in Rails</a> guide.</p>

<p>When we refresh this page and click “Delete” once again, we’ll see a new dialog box appear:</p>

<p><img src="/images/getting_started/confirm_dialog.png" alt="Confirm Dialog" /></p>

<p>If you press “Cancel” on this box, nothing will happen. The article will <em>not</em> be deleted. But if you press “OK”, then the article will be deleted. Rails provides this option on links just for links like this “Delete” link. We want people to be <em>really sure</em> that they mean to delete articles before they actually do it!</p>

<p>That is the last of our actions in the <code class="language-plaintext highlighter-rouge">ArticlesController</code>. We now have ways to create, read, update and delete articles. This pattern is so common in Rails applications that it even has its own acronym: CRUD: Create, Read, Update and Delete. What we have built here is a CRUD interface for articles.</p>

<h3 id="routing-for-resources">Routing for resources</h3>

<p>So far, we have not had to write much code to make our application functional. But there’s one extra thing that will massively reduce the lines of code you will write in the future, and that thing is called <em>resource routing</em>.</p>

<p>Rails has a convention that it follows when it comes to routing. When we list a collection of a resource, such as articles, that list is going to appear under the <code class="language-plaintext highlighter-rouge">index</code> action. When we want to see a single resource, such as a single article, that appears at the <code class="language-plaintext highlighter-rouge">show</code> action, and so on.</p>

<p>So far, we have been following this convention in Rails without drawing attention too much attention to it. In this section, we’re going to draw a lot of attention to it. By following this routing convention, we can simplify the code within <code class="language-plaintext highlighter-rouge">config/routes.rb</code> drastically. That file currently contains this code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/new"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#new"</span><span class="p">,</span> <span class="ss">as: :new_article</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span><span class="p">,</span> <span class="ss">as: :article</span>
  <span class="n">post</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#create"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id/edit"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#edit"</span><span class="p">,</span> <span class="ss">as: :edit_article</span>
  <span class="n">patch</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#update"</span>
  <span class="n">delete</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#destroy"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We’ve been able to define our routes using the <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">get</code>, <code class="language-plaintext highlighter-rouge">post</code>, <code class="language-plaintext highlighter-rouge">patch</code> and <code class="language-plaintext highlighter-rouge">delete</code> helpers. But Rails comes with one helper that we haven’t seen yet, and that helper is called <code class="language-plaintext highlighter-rouge">resources</code>.</p>

<p>We can delete most of the code in this routes file and replace it with this method call:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This one line replaces all 7 of the routes that we had defined previously. This is one of the parts of Rails that people claim as the most “magical”, and hopefully by defining all 7 routes manually first you will gain an appreciation for the elegance of <code class="language-plaintext highlighter-rouge">resources</code> here.</p>

<p>To see what this has done, we can run this command in the terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails routes <span class="nt">--controller</span> articles
</code></pre></div></div>

<p>Or:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails routes <span class="nt">-c</span> articles
</code></pre></div></div>

<p>This command will show us all the routes for the <code class="language-plaintext highlighter-rouge">ArticlesController</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      Prefix Verb   URI Pattern                  Controller#Action
        root GET    /                            articles#index
    articles GET    /articles(.:format)          articles#index
 new_article GET    /articles/new(.:format)      articles#new
     article GET    /articles/:id(.:format)      articles#show
             POST   /articles(.:format)          articles#create
edit_article GET    /articles/:id/edit(.:format) articles#edit
             PATCH  /articles/:id(.:format)      articles#update
             DELETE /articles/:id(.:format)      articles#destroy
</code></pre></div></div>

<p>This command shows us four things:</p>

<ul>
  <li>Prefix: The routing helper <em>prefix</em> that can be used to generate this route. For example “article” means <code class="language-plaintext highlighter-rouge">article_path</code> can be used.</li>
  <li>Verb: The HTTP Verb / method that is used to make this request.</li>
  <li>URI pattern: the <em>path</em> of the route that is used to make this request.</li>
  <li>Controller &amp; Action: The controller &amp; action that will serve this request.</li>
</ul>

<p>From this output, we’ll be able to tell that a <code class="language-plaintext highlighter-rouge">GET</code> request to <code class="language-plaintext highlighter-rouge">/articles/new</code> will go to the <code class="language-plaintext highlighter-rouge">ArticlesController</code>’s <code class="language-plaintext highlighter-rouge">new</code> action.</p>

<p>These are all the same routes that we had previously, it’s just that we’re using one line to generate them now instead of 7.</p>

<p>TIP: In general, Rails encourages using resources objects instead of declaring routes manually. For more information about routing, see <a href="routing.html">Rails Routing from the Outside In</a>.</p>

<p>We have now completely finished building the first part of our application. If you’ve gotten this far, give yourself a pat on the back! And maybe a little break before you continue on this guide.</p>

<p>We’re about two-thirds of the way through, and have just a few more features of Rails to show off.</p>

<h2 id="adding-comments">Adding Comments</h2>

<p>Let’s expand this application a little further by adding the ability for users to leave comments on articles.</p>

<h3 id="generating-a-model">Generating a Model</h3>

<p>To start with, we’re going to generate a model for comments.</p>

<p>We’re going to see the same generator that we used before when creating the <code class="language-plaintext highlighter-rouge">Article</code> model. This time we’ll create a <code class="language-plaintext highlighter-rouge">Comment</code> model to hold a reference to an article. Run this command in your terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails g model Comment commenter:string body:text article:references
</code></pre></div></div>

<p>This command will generate four files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>invoke  active_record
create    db/migrate/[timestamp]_create_comments.rb
create    app/models/comment.rb
invoke    test_unit
create      test/models/comment_test.rb
create      test/fixtures/comments.yml
</code></pre></div></div>

<p>First, let’s take a look at <code class="language-plaintext highlighter-rouge">app/models/comment.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This is very similar to the <code class="language-plaintext highlighter-rouge">Article</code> model that you saw earlier. The difference is the line <code class="language-plaintext highlighter-rouge">belongs_to :article</code>, which sets up an Active Record <em>association</em>. You’ll learn a little about associations in the next section of this guide. This <code class="language-plaintext highlighter-rouge">belongs_to</code> was added to our model because we specific <code class="language-plaintext highlighter-rouge">article:references</code> when we generated this model.</p>

<p>The <code class="language-plaintext highlighter-rouge">references</code> type is a special type that define an association between the model that we’re generating and another model. In this case, we’re saying that every comment <em>belongs to</em> an article.</p>

<p>Let’s look at the migration next:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:commenter</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">t.references</code> line creates does a few things:</p>

<ol>
  <li>It adds a field called <code class="language-plaintext highlighter-rouge">article_id</code> to the comments table</li>
  <li>A <a href="https://www.essentialsql.com/what-is-a-database-index/">database index</a> is added for that column. This will speed up retrieving comments for particular articles.</li>
  <li>The <code class="language-plaintext highlighter-rouge">null: false</code> option says that in no circumstance can this column be set to a <code class="language-plaintext highlighter-rouge">NULL</code> value.</li>
  <li>The <code class="language-plaintext highlighter-rouge">foreign_key: true</code> option says that this column is linked to the <code class="language-plaintext highlighter-rouge">articles</code> table, and that the column’s values must be represented in the <code class="language-plaintext highlighter-rouge">articles</code> table, in the <code class="language-plaintext highlighter-rouge">id</code> column. There can be no comments without a related article to match.</li>
</ol>

<p>Go ahead and run the migration:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails db:migrate
</code></pre></div></div>

<p>Rails is smart enough to only execute the migrations that have not already been
run against the current database, so in this case you will just see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==</span>  CreateComments: migrating <span class="o">=================================================</span>
<span class="nt">--</span> create_table<span class="o">(</span>:comments<span class="o">)</span>
   -&gt; 0.0115s
<span class="o">==</span>  CreateComments: migrated <span class="o">(</span>0.0119s<span class="o">)</span> <span class="o">========================================</span>
</code></pre></div></div>

<p>This migration will create our comments table. It will look like this in our database:</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>commenter</th>
      <th>body</th>
      <th>article_id</th>
      <th>created_at</th>
      <th>updated_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="associating-models">Associating Models</h3>

<p>Active Record associations let you easily declare the relationship between two
models. In the case of comments and articles, you could write out the
relationships this way:</p>

<ul>
  <li>Each comment belongs to one article.</li>
  <li>One article can have many comments.</li>
</ul>

<p>In fact, this is very close to the syntax that Rails uses to declare this
association. You’ve already seen the line of code inside the <code class="language-plaintext highlighter-rouge">Comment</code> model
(app/models/comment.rb) that makes each comment belong to an Article:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You’ll need to edit <code class="language-plaintext highlighter-rouge">app/models/article.rb</code> to add the other side of the
association:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>These two declarations enable a good bit of automatic behavior. Let’s explore some of this behaviour by starting up a new console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails c
</code></pre></div></div>

<p>First, let’s find an article:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>irb(main):001:0&gt; article = Article.first

Article Load (0.1ms)  SELECT "articles".* FROM "articles" ORDER BY "articles"."id" ASC LIMIT ?  [["LIMIT", 1]]

=&gt; #&lt;Article id: 1, title: "Hello Rails", body: "I'm on Rails", created_at: "2020-01-20 05:22:45", updated_at: "2020-01-20 05:22:45"&gt;
</code></pre></div></div>

<p>Next up, let’s create a new comment for this article by using the <code class="language-plaintext highlighter-rouge">comments</code> association method:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>irb(main):002:0&gt; article.comments.create(commenter: "DHH", body: "Welcome to Rails!")

Comment Create (0.4ms)  INSERT INTO "comments" ("commenter", "body", "article_id", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)  [["commenter", "DHH"], ["body", "Welcome to Rails!"], ["article_id", 9], ["created_at", "2020-01-20 06:19:33.572961"], ["updated_at", "2020-01-20 06:19:33.572961"]]

=&gt; #&lt;Comment id: 1, commenter: "DHH", body: "Welcome to Rails!", article_id: 1, created_at: "2020-01-20 06:19:33", updated_at: "2020-01-20 06:19:33"&gt;
</code></pre></div></div>

<p>If you look at the list of attributes here, you’ll see that both <code class="language-plaintext highlighter-rouge">commenter</code> and <code class="language-plaintext highlighter-rouge">body</code> are set the values that we passed in. We have come to expect this behaviour from Active Record: we give it attributes, it sets them on the object.</p>

<p>What we haven’t seen before is what has happened to <code class="language-plaintext highlighter-rouge">article_id</code> here. That attribute has been automatically set to the ID of the <code class="language-plaintext highlighter-rouge">article</code> object. This is what links that <code class="language-plaintext highlighter-rouge">Comment</code> object back to the article.</p>

<p>To find an article’s comments, we can do this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>irb(main):003:0&gt; article.comments

Comment Load (0.9ms)  SELECT "comments".* FROM "comments" WHERE "comments"."article_id" = ? LIMIT ?  [["article_id", 9], ["LIMIT", 11]]

=&gt; #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;Comment id: 1, commenter: "DHH", body: "Welcome to Rails!", article_id: 9, created_at: "2020-01-20 06:19:33", updated_at: "2020-01-20 06:19:33"&gt;]&gt;
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">comments</code> method on <code class="language-plaintext highlighter-rouge">Article</code> objects allows us to work with the comments for any given article.</p>

<p>Similarly, there is an <code class="language-plaintext highlighter-rouge">article</code> method on comments. Let’s see that in action too:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>irb(main):004:0&gt; comment = Comment.first

Comment Load (0.2ms)  SELECT "comments".* FROM "comments" ORDER BY "comments"."id" ASC LIMIT ?  [["LIMIT", 1]]

=&gt; #&lt;Comment id: 1, commenter: "DHH", body: "Welcome to Rails!", article_id: 9, created_at: "2020-01-20 06:19:33", updated_at: "2020-01-20 06:19:33"&gt;


irb(main):005:0&gt; comment.article

Article Load (0.2ms)  SELECT "articles".* FROM "articles" WHERE "articles"."id" = ? LIMIT ?  [["id", 9], ["LIMIT", 1]]

=&gt; #&lt;Article id: 9, title: "dsfsadfasdf", body: "asdfasdfasdf", created_at: "2020-01-20 05:22:45", updated_at: "2020-01-20 05:22:45"&gt;
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">article</code> method is granted to us by the <code class="language-plaintext highlighter-rouge">belongs_to</code> method call in the <code class="language-plaintext highlighter-rouge">Comment</code> model.</p>

<p>TIP: For more information on Active Record associations, see the <a href="association_basics.html">Active Record Associations</a> guide.</p>

<h3 id="displaying-comments-on-articles">Displaying comments on articles</h3>

<p>Now that we can create comments on articles, it would be really useful to display them somewhere. The most appropriate place to do that would be within the <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code> view. Let’s change this view now to display all of the comments:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Back"</span><span class="p">,</span> <span class="s2">"/"</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>The new code that we’ve just added to this view will go through all of the article’s comments and display the commenter and the comment that was made. When we go to <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a> now, we should see this comment appear:</p>

<p><img src="/images/getting_started/article_with_comments.png" alt="Article with comments" /></p>

<p>Well, that was pretty straight forward! Rails has given us an easy way to list all of the article comments, by way of the <code class="language-plaintext highlighter-rouge">has_many</code> method in the <code class="language-plaintext highlighter-rouge">Article</code> model.</p>

<h3 id="adding-a-comment">Adding a comment</h3>

<p>Now that we have a way to see all of the current comments, let’s add a form that lets us create additional comments. To start with, we’re going to put this form in <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code>, just below the comments we just added:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  ...
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span><span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>This form looks almost like the one in <code class="language-plaintext highlighter-rouge">app/views/articles/_form.html.erb</code>, but it has one key difference: the <code class="language-plaintext highlighter-rouge">model</code> key has been passed an array, instead of a single model instance. What will happen here is that the form will build what’s called a <em>nested route</em> for the comment.</p>

<p>The second element in that array is <code class="language-plaintext highlighter-rouge">@article.comments.build</code>. This is a helper method that comes from <code class="language-plaintext highlighter-rouge">has_many</code>, that is essentially equivalent to this code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Comment.new(article_id: @article.id)
</code></pre></div></div>

<p>We’re going to be building a new comment for the purposes of saving it to the database, eventually.</p>

<p>If we refresh <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>, we’ll see an error message which hints a little bit at this nested route:</p>

<p><img src="/images/getting_started/no_method_error_article_comments_path.png" alt="NoMethodError: article_comments_path" /></p>

<p>The <code class="language-plaintext highlighter-rouge">form_with</code> helper here is attempting to use a routing helper called <code class="language-plaintext highlighter-rouge">article_comments_path</code> to generate the route for the form. This routing helper doesn’t exist yet, and we’ll create it in a moment. But first, let’s talk about how Rails came to be wanting <code class="language-plaintext highlighter-rouge">article_comments_path</code> in the first place.</p>

<p>When we use <code class="language-plaintext highlighter-rouge">form_with</code>’s <code class="language-plaintext highlighter-rouge">:model</code> option, it combines the <em>class names</em> of the resources we pass it into a routing helper. Back when we were doing <code class="language-plaintext highlighter-rouge">form_with model: @article</code>, it would see that the class name of <code class="language-plaintext highlighter-rouge">@article</code> was <code class="language-plaintext highlighter-rouge">Article</code>. Then, <code class="language-plaintext highlighter-rouge">form_with</code> would see if this object had been saved to the database before or not. If the object had not been saved, the form would use <code class="language-plaintext highlighter-rouge">articles_path</code> – the <em>plural</em> version of the routing helper. If the object had been saved, it would use <code class="language-plaintext highlighter-rouge">article_path</code> – the <em>singular</em> version of routing helper.</p>

<p>The same rule applies here. <code class="language-plaintext highlighter-rouge">form_with</code>’s underlying code checks to see what <code class="language-plaintext highlighter-rouge">@article</code> is first. It’s an <code class="language-plaintext highlighter-rouge">Article</code> that has been saved to the database, so the first part of the routing helper is <code class="language-plaintext highlighter-rouge">article</code>. Then it checks what <code class="language-plaintext highlighter-rouge">@article.comments.build</code> is. This object is a <code class="language-plaintext highlighter-rouge">Comment</code> that has <em>not</em> been saved to the database, so the helper’s next component is <code class="language-plaintext highlighter-rouge">comments</code>. Then we’re out of array elements, so <code class="language-plaintext highlighter-rouge">form_with</code> puts <code class="language-plaintext highlighter-rouge">_path</code> on the end. This is how we arrive at <code class="language-plaintext highlighter-rouge">article_comments_path</code>.</p>

<p>This is another one of those excellent Rails conventions you’ve heard about throughout this guide. And it’s one of the more “magical” (or “confusing”) aspects of Rails. So don’t worry too much if you don’t get it first pass.</p>

<p>In order to solve the issue here, we need to add the route that has that routing helper. This time, however, instead of writing seven routes one-at-a-time for comments, just like we did for articles, we’re going to use <code class="language-plaintext highlighter-rouge">resources</code> again.</p>

<p>Open up the <code class="language-plaintext highlighter-rouge">config/routes.rb</code> file again, and edit it as follows:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This creates <code class="language-plaintext highlighter-rouge">comments</code> as a <em>nested resource</em> within <code class="language-plaintext highlighter-rouge">articles</code>. This is another part of capturing the hierarchical relationship that exists between articles and comments. By nesting comments inside of articles like this, this will give us the <code class="language-plaintext highlighter-rouge">article_comments_path</code> helper that our form is expecting.</p>

<p>We can verify this by going into a terminal and running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails routes -c comments
</code></pre></div></div>

<p>And we’ll see these routes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              Prefix Verb   URI Pattern                                       Controller#Action
    article_comments GET    /articles/:article_id/comments(.:format)          comments#index
                     POST   /articles/:article_id/comments(.:format)          comments#create
 new_article_comment GET    /articles/:article_id/comments/new(.:format)      comments#new
edit_article_comment GET    /articles/:article_id/comments/:id/edit(.:format) comments#edit
     article_comment GET    /articles/:article_id/comments/:id(.:format)      comments#show
                     PATCH  /articles/:article_id/comments/:id(.:format)      comments#update
                     PUT    /articles/:article_id/comments/:id(.:format)      comments#update
                     DELETE /articles/:article_id/comments/:id(.:format)      comments#destroy
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">article_comments</code> routing helper is the first line. We can see from this routing helper that it will generate the following path:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/articles/:article_id/comments
</code></pre></div></div>

<p>We can see this in action if we go back to <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a> and inspect the page’s HTML source again. We’ll see the form has that route as its <code class="language-plaintext highlighter-rouge">action</code> attribute:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/9/comments"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>TIP: For more information on routing, see the <a href="routing.html">Rails Routing</a>
guide.</p>

<p>When we fill out the comment form and click “Create Comment”, we’ll now see that the <code class="language-plaintext highlighter-rouge">CommentsController</code> is missing:</p>

<p><img src="/images/getting_started/comments_controller_missing.png" alt="Comments Controller missing" /></p>

<h3 id="generating-a-controller">Generating a Controller</h3>

<p>To fix this issue, we will need to generate the <code class="language-plaintext highlighter-rouge">CommentsController</code>. Let’s do that now:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bin/rails g controller comments
</code></pre></div></div>

<p>This creates four files and one empty directory:</p>

<table>
  <thead>
    <tr>
      <th>File/Directory</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>app/controllers/comments_controller.rb</td>
      <td>The Comments controller</td>
    </tr>
    <tr>
      <td>app/views/comments/</td>
      <td>Views of the controller are stored here</td>
    </tr>
    <tr>
      <td>test/controllers/comments_controller_test.rb</td>
      <td>The test for the controller</td>
    </tr>
    <tr>
      <td>app/helpers/comments_helper.rb</td>
      <td>A view helper file</td>
    </tr>
    <tr>
      <td>app/assets/stylesheets/comments.scss</td>
      <td>Cascading style sheet for the controller</td>
    </tr>
  </tbody>
</table>

<p>If we attempt to submit the form again, we’ll see that the <code class="language-plaintext highlighter-rouge">create</code> action is missing in this new controller:</p>

<p><img src="/images/getting_started/create_action_comments_controller.png" alt="Create action missing in CommentsController" /></p>

<p>Let’s wire up the <code class="language-plaintext highlighter-rouge">create</code> in <code class="language-plaintext highlighter-rouge">app/controllers/comments_controller.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You’ll see a bit more complexity here than you did in the controller for articles. That’s a side-effect of the nesting that you’ve set up. Each request for a comment has to keep track of the article to which the comment is attached, thus the initial call to the <code class="language-plaintext highlighter-rouge">find</code> method of the <code class="language-plaintext highlighter-rouge">Article</code> model to get the article in question.</p>

<p>But where did we get the idea for <code class="language-plaintext highlighter-rouge">article_id</code> from? Well, if we look at our route again with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails routes -c comments
</code></pre></div></div>

<p>Then we’ll see:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              Prefix Verb   URI Pattern                                       Controller#Action
    article_comments GET    /articles/:article_id/comments
</code></pre></div></div>

<p>The colon before <code class="language-plaintext highlighter-rouge">:article_id</code> indicates that this part of the URL will be available as <code class="language-plaintext highlighter-rouge">params[:article_id]</code> in our controller. This is why we’re using <code class="language-plaintext highlighter-rouge">:article_id</code> here, and not <code class="language-plaintext highlighter-rouge">:id</code>.</p>

<p>In addition, the code takes advantage of some of the methods available for an association. We use the <code class="language-plaintext highlighter-rouge">create</code> method on <code class="language-plaintext highlighter-rouge">@article.comments</code> to create and save the comment. This will automatically link the comment so that it belongs to
that particular article, just as we saw earlier when we created a comment in the Rails console.</p>

<p>Once we have made the new comment, we send the user back to the original article using the <code class="language-plaintext highlighter-rouge">article_path(@article)</code> helper. As we have already seen, this calls the <code class="language-plaintext highlighter-rouge">show</code> action of the <code class="language-plaintext highlighter-rouge">ArticlesController</code> which in turn renders the <code class="language-plaintext highlighter-rouge">show.html.erb</code> template.</p>

<p>If we fill out the comment form again, we will see our comment appear.</p>

<p>Now you can add articles and comments to your blog and have them show up in the right places.</p>

<p><img src="/images/getting_started/article_with_two_comments.png" alt="Article with Two Comments" /></p>

<h2 id="refactoring">Refactoring</h2>

<p>Now that we have articles and comments working, take a look at the <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code> template. It is getting long and awkward. We can use partials to clean this view up.</p>

<h3 id="rendering-partial-collections">Rendering Partial Collections</h3>

<p>First, we will make a comment partial to extract showing all the comments for the article. Create the file <code class="language-plaintext highlighter-rouge">app/views/comments/_comment.html.erb</code> and put the following into it:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<p>Then you can change <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code> to look like the
following:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Title:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Text:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

...
</code></pre></div></div>

<p>This is the third style of <code class="language-plaintext highlighter-rouge">render</code> that we’ve seen throughout this guide.</p>

<p>The first was <code class="language-plaintext highlighter-rouge">render</code> in an action. That one will render a view by using code like <code class="language-plaintext highlighter-rouge">render "new"</code>.</p>

<p>The second was <code class="language-plaintext highlighter-rouge">render</code> in a view, we saw it in <code class="language-plaintext highlighter-rouge">app/views/articles/new.html.erb</code> and <code class="language-plaintext highlighter-rouge">app/views/articles/edit.html.erb</code>. It was written as <code class="language-plaintext highlighter-rouge">&lt;%= render "form", article: @article %&gt;</code>, and that meant to render the partial at <code class="language-plaintext highlighter-rouge">app/views/articles/_form.html.erb</code>.</p>

<p>This third one is <code class="language-plaintext highlighter-rouge">render</code> with a collection of objects. Rails will inspect these objects and see what class they are, and then it will render a partial that matches the name of the class: <code class="language-plaintext highlighter-rouge">comments/_comment.html.erb</code> for this one. If we were to do the same sort of thing for articles, it would render <code class="language-plaintext highlighter-rouge">articles/_article.html.erb</code>.</p>

<p>Inside the <code class="language-plaintext highlighter-rouge">comments/_comment.html.erb</code> partial, we’re able to refer to the local variable <code class="language-plaintext highlighter-rouge">comment</code> to refer to each comment, just like we did earlier with the <code class="language-plaintext highlighter-rouge">each</code> version of this code.</p>

<h3 id="rendering-a-partial-form">Rendering a Partial Form</h3>

<p>Let’s keep tidying up this <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code> view. We can definitely move that comment form out too.</p>

<p>Let us also move that new comment section out to its own partial. To do this, we create a file <code class="language-plaintext highlighter-rouge">app/views/comments/_form.html.erb</code> containing:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="n">article</span><span class="p">,</span> <span class="n">article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span><span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Then you make the <code class="language-plaintext highlighter-rouge">app/views/articles/show.html.erb</code> look like the following:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"comments/form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>

...
</code></pre></div></div>

<p>This is the second version of the <code class="language-plaintext highlighter-rouge">render</code> method: it will render that partial at <code class="language-plaintext highlighter-rouge">app/views/comments/_form.html.erb</code> and pass through the instance variable of <code class="language-plaintext highlighter-rouge">@article</code> as a local variable called <code class="language-plaintext highlighter-rouge">article</code> to that partial.</p>

<h2 id="deleting-comments">Deleting Comments</h2>

<p>Another important feature of a blog is being able to delete spam comments. To do this, we need to implement a link of some sort in the view and a <code class="language-plaintext highlighter-rouge">destroy</code>
action in the <code class="language-plaintext highlighter-rouge">CommentsController</code>.</p>

<p>So first, let’s add the delete link in the
<code class="language-plaintext highlighter-rouge">app/views/comments/_comment.html.erb</code> partial:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destroy Comment'</span><span class="p">,</span> <span class="p">[</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">],</span>
               <span class="ss">method: :delete</span><span class="p">,</span>
               <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Are you sure?'</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<p>The second argument to <code class="language-plaintext highlighter-rouge">link_to</code> is new to us. Well, sort of. We’ve seen it just before in the form for comments, but that was with <code class="language-plaintext highlighter-rouge">form_with</code>, and this is with <code class="language-plaintext highlighter-rouge">link_to</code>. This syntax for <code class="language-plaintext highlighter-rouge">link_to</code> works exactly the same as it did back in <code class="language-plaintext highlighter-rouge">form_with</code>; it works to build a routing helper. The <code class="language-plaintext highlighter-rouge">link_to</code> helper checks to see what kind of object <code class="language-plaintext highlighter-rouge">comment.article</code> is. It’s an <code class="language-plaintext highlighter-rouge">Article</code> object and that object exists in the database, so the first part of that helper is <code class="language-plaintext highlighter-rouge">article</code>. Then the second object is a <code class="language-plaintext highlighter-rouge">Comment</code> object, and so the second part is <code class="language-plaintext highlighter-rouge">comment</code>. This means that the routing helper used will be <code class="language-plaintext highlighter-rouge">article_comment_path</code>.</p>

<p>We could write this code out in a longer fashion if we wished:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destroy Comment'</span><span class="p">,</span> <span class="n">article_comment_path</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">),</span>
               <span class="ss">method: :delete</span><span class="p">,</span>
               <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Are you sure?'</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<p>But Rails’ routing conventions save us some time and keystrokes by allowing us to write <code class="language-plaintext highlighter-rouge">[comment.article, comment]</code> instead.</p>

<p>Clicking this new “Destroy Comment” link will fire off a <code class="language-plaintext highlighter-rouge">DELETE /articles/:article_id/comments/:id</code> to our <code class="language-plaintext highlighter-rouge">CommentsController</code>, which can then use this to find the comment we want to delete. Right now, the <code class="language-plaintext highlighter-rouge">destroy</code> action that matches that route is missing, and so we will see this if we attempt to delete a comment:</p>

<p><img src="/images/getting_started/comments_destroy_not_found.png" alt="Destroy not found" /></p>

<p>So let’s add a <code class="language-plaintext highlighter-rouge">destroy</code> action
to our controller (<code class="language-plaintext highlighter-rouge">app/controllers/comments_controller.rb</code>):</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@comment</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">destroy</code> action will find the article we are looking at, locate the comment within the <code class="language-plaintext highlighter-rouge">@article.comments</code> collection, and then remove it from the database and send us back to the show action for the article.</p>

<p>If we attempt to delete a comment again, this time it will disppaear.</p>

<h3 id="deleting-associated-objects">Deleting Associated Objects</h3>

<p>If you delete an article, its associated comments will also need to be deleted, otherwise we would see an <code class="language-plaintext highlighter-rouge">ActiveRecord::InvalidForeignKey</code> error happen:</p>

<p><img src="/images/getting_started/foreign_key_constraint.png" alt="Foreign key constraint" /></p>

<p>This error happens because the database will not allow <code class="language-plaintext highlighter-rouge">comments</code> to be without an associated article, due to this line in the <code class="language-plaintext highlighter-rouge">db/migrate/[timestamp]_create_comments.rb</code> migration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>t.references :article, null: false, foreign_key: true
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">foreign_key</code> option on this line, when set to <code class="language-plaintext highlighter-rouge">true</code>, says  that the <code class="language-plaintext highlighter-rouge">article_id</code> column within the <code class="language-plaintext highlighter-rouge">comments</code> table must have a matching <code class="language-plaintext highlighter-rouge">id</code> value in the <code class="language-plaintext highlighter-rouge">articles</code> table. If a situation arises where this <em>might</em> happen, the database raises a <em>foreign key constraint</em> error, which is what we’re seeing here.</p>

<p>To avoid this issue, we need to give our <code class="language-plaintext highlighter-rouge">Article</code>’s <code class="language-plaintext highlighter-rouge">comments</code> association one extra option, called <code class="language-plaintext highlighter-rouge">dependent</code>. Let’s change <code class="language-plaintext highlighter-rouge">app/models/article.rb</code> to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now when an article is deleted, all of its comments will be deleted too, and we will avoid having a foreign key constraint error happen.</p>

<h2 id="security">Security</h2>

<h3 id="basic-authentication">Basic Authentication</h3>

<p>If you were to publish your blog online, anyone would be able to add, edit and delete articles or delete comments.</p>

<p>Rails provides a very simple HTTP authentication system that will work nicely in this situation.</p>

<p>In the <code class="language-plaintext highlighter-rouge">ArticlesController</code> we need to have a way to block access to the various actions if the person is not authenticated. Here we can use the Rails <code class="language-plaintext highlighter-rouge">http_basic_authenticate_with</code> method, which allows access to the requested action if that method allows it.</p>

<p>To use the authentication system, we specify it at the top of our <code class="language-plaintext highlighter-rouge">ArticlesController</code> in <code class="language-plaintext highlighter-rouge">app/controllers/articles_controller.rb</code>. In our case, we want the user to be authenticated on every action except <code class="language-plaintext highlighter-rouge">index</code> and <code class="language-plaintext highlighter-rouge">show</code>,
so we write that:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre></div></div>

<p>We also want to allow only authenticated users to delete comments, so in the <code class="language-plaintext highlighter-rouge">CommentsController</code> (<code class="language-plaintext highlighter-rouge">app/controllers/comments_controller.rb</code>) we write:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">only: :destroy</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre></div></div>

<p>Now if you try to create a new article, you will be greeted with a basic HTTP Authentication challenge:</p>

<p><img src="images/getting_started/challenge.png" alt="Basic HTTP Authentication Challenge" /></p>

<p>Other authentication methods are available for Rails applications. Two popular
authentication add-ons for Rails are the
<a href="https://github.com/plataformatec/devise">Devise</a> rails engine and
the <a href="https://github.com/binarylogic/authlogic">Authlogic</a> gem,
along with a number of others.</p>

<h3 id="other-security-considerations">Other Security Considerations</h3>

<p>Security, especially in web applications, is a broad and detailed area. Security
in your Rails application is covered in more depth in
the <a href="security.html">Ruby on Rails Security Guide</a>.</p>

<h2 id="whats-next">What’s Next?</h2>

<p>Now that you’ve seen your first Rails application, you should feel free to
update it and experiment on your own.</p>

<p>Remember, you don’t have to do everything without help. As you need assistance
getting up and running with Rails, feel free to consult these support
resources:</p>

<ul>
  <li>The <a href="index.html">Ruby on Rails Guides</a></li>
  <li>The <a href="https://groups.google.com/group/rubyonrails-talk">Ruby on Rails mailing list</a></li>
  <li>The <a href="irc://irc.freenode.net/#rubyonrails">#rubyonrails</a> channel on irc.freenode.net</li>
</ul>

<h2 id="configuration-gotchas">Configuration Gotchas</h2>

<p>The easiest way to work with Rails is to store all external data as UTF-8. If
you don’t, Ruby libraries and Rails will often be able to convert your native
data into UTF-8, but this doesn’t always wowrk reliably, so you’re better off
ensuring that all external data is UTF-8.</p>

<p>If you have made a mistake in this area, the most common symptom is a black
diamond with a question mark inside appearing in the browser. Another common
symptom is characters like “Ã¼” appearing instead of “ü”. Rails takes a number
of internal steps to mitigate common causes of these problems that can be
automatically detected and corrected. However, if you have external data that is
not stored as UTF-8, it can occasionally result in these kinds of issues that
cannot be automatically detected by Rails and corrected.</p>

<p>Two very common sources of data that are not UTF-8:</p>

<ul>
  <li>Your text editor: Most text editors (such as TextMate), default to saving
files as UTF-8. If your text editor does not, this can result in special
characters that you enter in your templates (such as é) to appear as a diamond
with a question mark inside in the browser. This also applies to your i18n
translation files. Most editors that do not already default to UTF-8 (such as
some versions of Dreamweaver) offer a way to change the default to UTF-8. Do
so.</li>
  <li>Your database: Rails defaults to converting data from your database into UTF-8
at the boundary. However, if your database is not using UTF-8 internally, it
may not be able to store all characters that your users enter. For instance,
if your database is using Latin-1 internally, and your user enters a Russian,
Hebrew, or Japanese character, the data will be lost forever once it enters
the database. If possible, use UTF-8 as the internal storage of your database.</li>
</ul>

          </article>
        </div>
      </div>
    </div>
    <footer>
    01101110 01101111 01110100 01101000 01101001 01101110 01100111 00100000 01110100 01101111 00100000 01110011 01100101 01100101 00100000 01101000 01100101 01110010 01100101 0001010 0001010 0001010 0001010 0001010 01100010 01110010 01100001 01110110 01101111 00100000 01100110 01101111 01111000 01110100 01110010 01101111 01110100 00100000 01110101 01101110 01101001 01100110 01101111 01110010 01101101
</footer>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60556315-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
